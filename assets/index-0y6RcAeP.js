import{c as _,j as a,r as T,R as _t}from"./react-B2RL9x2s.js";import{c as Jt}from"./react-dom-BizTJEze.js";import{T as Zt,t as yt}from"./sonner-CRkCOcXB.js";import{c as mt,p as es}from"./zustand-DdNYQz4c.js";import{l as it}from"./lodash-BkzDGCz7.js";import{I as ts,C as ss,a as as,S as ls,M as rs,b as Ne,c as ns,d as Lt,D as Te,e as It,f as is,g as os,T as cs,H as ds,h as ms,i as us,K as fs,j as xs,k as Ie,l as ps,m as hs,n as bs,o as gs,G as ys,P as Ke,p as Xe,q as $t,r as ut,A as js,s as Ns,t as vs,F as ft,u as ws,v as Ss,w as $e,L as zt,x as xt,y as Ge,z as Cs,B as Dt,E as Es,J as Ts,N as _s,O as at,X as kt,Q as Ls}from"./lucide-react-DERuKLzj.js";import{c as Is}from"./clsx-B-dksMZM.js";import{t as $s}from"./tailwind-merge-BJOqOzcM.js";import{R as zs,T as Ds,C as ks,L as Rs,S as Os,a as Ps,b as As,V as Ms,P as Fs,c as Us,I as qs,d as Hs,e as Bs,f as Qs,g as Vs,h as Ws,i as Gs,j as Ks,k as Xs,l as Ys,m as Js,n as Zs,o as ea,p as ta,q as sa,r as aa,s as la,t as ra,D as na,u as ia,v as oa,O as ca}from"./@radix-ui-CcK_EW8Q.js";import{c as da}from"./class-variance-authority-Dp3B9jqt.js";import{P as ma,a as ua,b as fa}from"./react-resizable-panels-CS3z951J.js";import{R as xa,d as pa}from"./@uiw-ChcphOCW.js";import{G as ha,I as ba,r as ga}from"./@codemirror-Bbikk1gI.js";import"./scheduler-SPyfQU6S.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-DWlXkXzq.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-DpNLLOLX.js";import"./react-style-singleton-D7c23Nxa.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-BS8h9NSd.js";import"./use-callback-ref-hrg4jhP2.js";import"./@floating-ui-xbqwxxL4.js";import"./@babel-Cv5OCJ0e.js";import"./@lezer-E7PapBHi.js";import"./crelt-C8TCjufn.js";import"./@marijn-DXwl3gUT.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(r){if(r.ep)return;r.ep=!0;const n=s(r);fetch(r.href,n)}})();function ya(){const t=_.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=a.jsx(Zt,{position:"bottom-center",toastOptions:{className:"custom-toast",duration:2e3,style:{fontFamily:"Lexend, sans-serif",borderRadius:"0.5rem",fontSize:"0.875rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",border:"1px solid var(--border)",background:"var(--background)",color:"var(--foreground)"}}}),t[0]=e):e=t[0],e}const ja={theme:"system",setTheme:()=>null},Rt=T.createContext(ja);function Na(t){const e=_.c(20);let s,l,r,n;e[0]!==t?({children:s,defaultTheme:r,storageKey:n,...l}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r,e[4]=n):(s=e[1],l=e[2],r=e[3],n=e[4]);const i=r===void 0?"system":r,o=n===void 0?"vite-ui-theme":n;let d;e[5]!==i||e[6]!==o?(d=()=>localStorage.getItem(o)||i,e[5]=i,e[6]=o,e[7]=d):d=e[7];const[m,c]=T.useState(d);let u;e[8]!==o?(u=v=>{localStorage.setItem(o,v),c(v)},e[8]=o,e[9]=u):u=e[9];const f=u;let x,b;e[10]!==m?(x=()=>{const v=document.documentElement;if(v.classList.remove("light","dark"),m==="system"){const w=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";v.classList.add(w)}else v.classList.add(m)},b=[m],e[10]=m,e[11]=x,e[12]=b):(x=e[11],b=e[12]),T.useEffect(x,b);let g,h;e[13]!==m||e[14]!==f?(h={theme:m,setTheme:f},e[13]=m,e[14]=f,e[15]=h):h=e[15],g=h;const p=g;let j;return e[16]!==s||e[17]!==l||e[18]!==p?(j=a.jsx(Rt.Provider,{...l,value:p,children:s}),e[16]=s,e[17]=l,e[18]=p,e[19]=j):j=e[19],j}const pe=(t,e,s)=>{const l=_.c(5),r=s===void 0?!1:s;let n,i;l[0]!==e||l[1]!==r||l[2]!==t?(n=()=>{const o=d=>{const m=t.split("+"),c=m.includes("ctrl");let u;u=d.key,r||(u=u.toLowerCase());const f=d.ctrlKey||!c,x=m.some(b=>b==="ctrl"?!1:r?b===d.key:b.toLowerCase()===u);f&&x&&(d.preventDefault(),d.stopPropagation(),e())};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},i=[t,e,r],l[0]=e,l[1]=r,l[2]=t,l[3]=n,l[4]=i):(n=l[3],i=l[4]),T.useEffect(n,i)},S=mt()(es((t,e)=>({tablesSchema:{},indexesSchema:[],currentTable:null,data:null,columns:null,maxSize:1,isDatabaseLoading:!1,isDataLoading:!1,errorMessage:null,filters:null,sorters:null,limit:50,offset:0,customQuery:void 0,customQueryObject:null,queryOffset:0,queryLimit:50,sqlHistory:[],setTablesSchema:s=>t({tablesSchema:s}),setIndexesSchema:s=>t({indexesSchema:s}),setCurrentTable:s=>t({currentTable:s}),setData:s=>t({data:s}),setColumns:s=>t({columns:s}),setMaxSize:s=>t({maxSize:s}),setIsDatabaseLoading:s=>t({isDatabaseLoading:s}),setIsDataLoading:s=>t({isDataLoading:s}),setErrorMessage:s=>t({errorMessage:s}),setFilters:s=>t({filters:s}),setSorters:s=>t({sorters:s}),setLimit:s=>t({limit:s}),setOffset:s=>t({offset:s}),setCustomQuery:s=>t({customQuery:s}),setCustomQueryObject:s=>t({customQueryObject:s}),resetPagination:()=>t({offset:0}),setQueryOffset:s=>t({queryOffset:s}),setQueryLimit:s=>t({queryLimit:s}),resetQueryPagination:()=>t({queryOffset:0}),addSqlHistory:s=>{const l=s.trim();if(!l)return;const{sqlHistory:r}=e(),n=r.findIndex(d=>d.query===l),i={id:Date.now().toString(),query:l,timestamp:Date.now(),executedAt:new Date().toLocaleString("zh-CN")};let o;n!==-1?o=[i,...r.filter((d,m)=>m!==n)]:o=[i,...r],o.length>50&&(o=o.slice(0,50)),t({sqlHistory:o})},removeSqlHistory:s=>{const{sqlHistory:l}=e();t({sqlHistory:l.filter(r=>r.id!==s)})},clearSqlHistory:()=>{t({sqlHistory:[]})},useSqlFromHistory:s=>{t({customQuery:s})},resetExecuteState:()=>{t({customQuery:"",customQueryObject:null,queryOffset:0,queryLimit:50,errorMessage:null})}}),{name:"sqlite-viewer-storage",partialize:t=>({sqlHistory:t.sqlHistory})})),fe=mt(t=>{const e=it.debounce(l=>t({schemaPanelSize:l}),200),s=it.debounce(l=>t({dataPanelSize:l}),200);return{schemaPanelSize:25,dataPanelSize:75,editValues:[],isInserting:!1,setSchemaPanelSize:e,setDataPanelSize:s,setEditValues:l=>t({editValues:l}),setIsInserting:l=>t({isInserting:l})}}),Ot=T.createContext(void 0),ve=()=>{const t=T.useContext(Ot);if(t===void 0)throw new Error("usePanelManager must be used within a PanelProvider");return t},jt={success:"#22c55e",error:"#ef4444",info:"#3b82f6"};function K(t,e="info",s={}){if(typeof t=="string"){const l={success:a.jsx(as,{className:"h-5 w-5 text-green-500"}),error:a.jsx(ss,{className:"h-5 w-5 text-red-500"}),info:a.jsx(ts,{className:"h-5 w-5 text-blue-500"})};setTimeout(()=>{yt(a.jsxs("div",{className:"flex items-center gap-2",children:[l[e],a.jsx("div",{className:"flex-1 capitalize",children:t})]}),{style:{borderLeft:`4px solid ${jt[e]}`,background:"var(--background)"},...s})},0)}else setTimeout(()=>{yt(t,{style:{borderLeft:`4px solid ${jt[e]}`,background:"var(--background)"},...s})},0)}const Pt=T.createContext(void 0);function B(...t){return $s(Is(t))}function Nt(t,e,s=!0){if(s){const l=URL.createObjectURL(t),r=document.createElement("a");r.href=l,r.download=e,r.click()}else{const l=localStorage.getItem("currentDatabase");window.parent.postMessage({type:"downloadFile",blob:t,fileName:e,filePath:l},"*")}}const vt=33,va=t=>{const e=_.c(122),{children:s}=t,l=T.useRef(null),r=S(wa),n=S(Sa),i=S(Ca),o=S(Ea),d=S(Ta),m=S(_a),c=S(La),u=S(Ia),f=S($a),x=S(za),b=S(Da),g=S(ka),h=S(Ra),p=S(Oa),j=S(Pa),v=S(Aa),w=S(Ma),N=S(Fa),E=S(Ua),z=S(qa),C=S(Ha),I=S(Ba),y=S(Qa),$=S(Va),{selectedRowObject:L,setSelectedRowObject:D,setIsInserting:R,handleCloseEdit:k}=ve(),[O,A]=T.useState(!0);let M;e[0]!==k||e[1]!==m||e[2]!==i||e[3]!==I||e[4]!==o||e[5]!==x||e[6]!==N||e[7]!==n||e[8]!==f||e[9]!==u||e[10]!==R||e[11]!==c||e[12]!==w||e[13]!==D||e[14]!==E||e[15]!==r?(M=()=>(l.current=new Worker(new URL("/assets/sqliteWorker-DqcLnO6A.js",import.meta.url),{type:"module"}),l.current.onmessage=q=>{var oe,ce,ge,je,we,_e;const H=q.data,{action:V}=H;if(V==="initComplete"){const{payload:W}=H;r(W.tableSchema),n(W.indexSchema),i(W.currentTable),m((ge=(ce=(oe=W.tableSchema)==null?void 0:oe[W.currentTable])==null?void 0:ce.schema)==null?void 0:ge.map(Wa)),N(null),E(null),D(null),R(!1),w(0),u(!1);const{resetExecuteState:re}=S.getState();re()}else if(V==="queryComplete"){const{payload:W}=H;c(W.maxSize);const re=W.results;if(!re)o(null);else{const ye=((je=re[0])==null?void 0:je.values)||[];ye.length!==0?o(ye):o(null)}f(!1)}else if(V==="customQueryComplete"){const{payload:W}=H,re=W.results;if(!re)o(null);else{const ye=((we=re[0])==null?void 0:we.values)||[];ye.length!==0?I({data:ye,columns:((_e=re[0])==null?void 0:_e.columns)||[]}):I(null)}f(!1),x(null)}else if(V==="updateInstance"){const{payload:W}=H;r(W.tableSchema),n(W.indexSchema),f(!1),x(null),K("Database schema updated successfully","success")}else if(V==="updateComplete"){const{payload:W}=H;x(null),k(),K(`Row ${W.type} successfully`,"success")}else if(V==="insertComplete")x(null),k(),K("Row inserted successfully","success");else if(V==="downloadComplete"){const{payload:W}=H,re=new Blob([W.bytes],{type:"application/octet-stream"});Nt(re,"database.sqlite",!new URLSearchParams(window.location.search).get("databases")),K("Database downloaded successfully","success")}else if(V==="exportComplete"){const{payload:W}=H,re=W.format==="txt"?"text/plain":"text/csv",st=`export.${W.format==="txt"?"txt":"csv"}`,We=new Blob([W.results],{type:re});Nt(We,st,!new URLSearchParams(window.location.search).get("databases")),K("Database exported successfully","success")}else if(V==="queryError"){const{payload:W}=H;console.error("Worker error:",W.error),f(!1),W.error.isCustomQueryError&&x(W.error.message),K(W.error.message,"error")}else console.warn("Unknown action:",V)},u(!1),l.current.postMessage({action:"init"}),()=>{var q;(q=l.current)==null||q.terminate()}),e[0]=k,e[1]=m,e[2]=i,e[3]=I,e[4]=o,e[5]=x,e[6]=N,e[7]=n,e[8]=f,e[9]=u,e[10]=R,e[11]=c,e[12]=w,e[13]=D,e[14]=E,e[15]=r,e[16]=M):M=e[16];let F;e[17]!==k||e[18]!==m||e[19]!==i||e[20]!==d||e[21]!==I||e[22]!==o||e[23]!==x||e[24]!==N||e[25]!==n||e[26]!==f||e[27]!==u||e[28]!==R||e[29]!==c||e[30]!==w||e[31]!==D||e[32]!==E||e[33]!==r?(F=[m,w,u,r,i,n,I,o,c,f,x,N,E,D,k,R,d],e[17]=k,e[18]=m,e[19]=i,e[20]=d,e[21]=I,e[22]=o,e[23]=x,e[24]=N,e[25]=n,e[26]=f,e[27]=u,e[28]=R,e[29]=c,e[30]=w,e[31]=D,e[32]=E,e[33]=r,e[34]=F):F=e[34],T.useEffect(M,F);let U,X;e[35]!==j||e[36]!==b||e[37]!==O||e[38]!==p||e[39]!==f||e[40]!==z||e[41]!==g?(U=()=>{if(!j)return;const q=setTimeout(()=>{var ge,je,we;if(!l.current){K("Worker is not initialized","error");return}f(!0);let H=50;const V=(ge=document.getElementById("tableHeader"))==null?void 0:ge.getBoundingClientRect().height,oe=(je=document.getElementById("dataSection"))==null?void 0:je.getBoundingClientRect().height,ce=(we=document.getElementById("paginationControls"))==null?void 0:we.getBoundingClientRect().height;O?(A(!1),oe&&ce&&(H=Math.floor((oe-ce-47.5)/vt))):V&&oe&&ce&&(H=Math.floor((oe-V-ce)/vt)),z(H),l.current.postMessage({action:"getTableData",payload:{currentTable:j,filters:b,sorters:g,limit:H,offset:p}})},100);return()=>clearTimeout(q)},X=[j,b,g,O,p,z,f],e[35]=j,e[36]=b,e[37]=O,e[38]=p,e[39]=f,e[40]=z,e[41]=g,e[42]=U,e[43]=X):(U=e[42],X=e[43]),T.useEffect(U,X);let Q;e[44]!==u?(Q=q=>{K("Opening database","info"),u(!0);const H=new FileReader;H.onload=V=>{var ge,je;const oe=(ge=V.target)==null?void 0:ge.result;if(!l.current){K("Worker is not initialized","error"),u(!1);return}l.current.postMessage({action:"closeDatabase"});const ce=we=>{var _e,W,re;if(we.data.action==="closeDatabaseComplete"){(_e=l.current)==null||_e.removeEventListener("message",ce),(W=l.current)==null||W.postMessage({action:"init"});const ye=st=>{var We,gt;st.data.action==="initComplete"&&((We=l.current)==null||We.removeEventListener("message",ye),(gt=l.current)==null||gt.postMessage({action:"openFile",payload:{file:oe}}))};(re=l.current)==null||re.addEventListener("message",ye)}};(je=l.current)==null||je.addEventListener("message",ce)},H.readAsArrayBuffer(q)},e[44]=u,e[45]=Q):Q=e[45];const G=Q;let J;e[46]!==G?(J=q=>{var V;const H=(V=q.target.files)==null?void 0:V[0];if(!H){K("No file selected","error");return}G(H)},e[46]=G,e[47]=J):J=e[47];const Z=J;let ne;e[48]===Symbol.for("react.memo_cache_sentinel")?(ne=()=>{if(!l.current){K("Worker is not initialized","error");return}l.current.postMessage({action:"download"})},e[48]=ne):ne=e[48];const de=ne;let ae;e[49]!==C||e[50]!==m||e[51]!==i||e[52]!==N||e[53]!==R||e[54]!==c||e[55]!==D||e[56]!==E||e[57]!==$?(ae=q=>{N(null),E(null),C(),c(0),D(null),R(!1),i(q),m($[q].schema.map(Ga))},e[49]=C,e[50]=m,e[51]=i,e[52]=N,e[53]=R,e[54]=c,e[55]=D,e[56]=E,e[57]=$,e[58]=ae):ae=e[58];const te=ae;let ee;e[59]!==C||e[60]!==N?(ee=(q,H)=>{const oe={...S.getState().filters||{},[q]:H};N(oe),C()},e[59]=C,e[60]=N,e[61]=ee):ee=e[61];const se=ee;let ie;e[62]!==E?(ie=q=>{const oe=((S.getState().sorters||{})[q]||"asc")==="asc"?"desc":"asc",ce={[q]:oe};E(ce)},e[62]=E,e[63]=ie):ie=e[63];const he=ie;let be;e[64]!==h||e[65]!==v||e[66]!==w||e[67]!==D?(be=q=>{const H=S.getState().offset;if(v){if(typeof q=="number")w(q);else if(q==="next"){const V=H+h;V>=v?v-h<0&&w(0):w(V)}else if(q==="prev"){const V=H-h;V<0?w(0):w(V)}else q==="first"?w(0):q==="last"&&(v-h<0?w(0):w(v-h));D(null)}},e[64]=h,e[65]=v,e[66]=w,e[67]=D,e[68]=be):be=e[68];const le=be;let De;e[69]!==j||e[70]!==y||e[71]!==b||e[72]!==h||e[73]!==p||e[74]!==g?(De=(q,H)=>{const V=H===void 0?"csv":H;if(!l.current){K("Worker is not initialized","error");return}l.current.postMessage({action:"export",payload:{table:j,offset:p,limit:h,filters:b,sorters:g,customQuery:y,exportType:q,exportFormat:V}})},e[69]=j,e[70]=y,e[71]=b,e[72]=h,e[73]=p,e[74]=g,e[75]=De):De=e[75];const et=De;let ke;e[76]!==j||e[77]!==y||e[78]!==b||e[79]!==h||e[80]!==p||e[81]!==f||e[82]!==g?(ke=()=>{if(!l.current){K("Worker is not initialized","error");return}const{isDatabaseLoading:q}=S.getState();if(q){K("Database is loading, please wait","info");return}const H=y;if(!H){K("Please enter a SQL query","info");return}const V=S.getState().addSqlHistory;V(H);const ce=H.replace(/--.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").split(";").map(Ka).filter(Xa);for(const ge of ce)f(!0),l.current.postMessage({action:"exec",payload:{query:ge,currentTable:j,filters:b,sorters:g,limit:h,offset:p}})},e[76]=j,e[77]=y,e[78]=b,e[79]=h,e[80]=p,e[81]=f,e[82]=g,e[83]=ke):ke=e[83];const Ce=ke;let Re;e[84]!==j||e[85]!==b||e[86]!==h||e[87]!==p||e[88]!==(L==null?void 0:L.primaryValue)||e[89]!==f||e[90]!==g?(Re=q=>{if(!l.current){K("Worker is not initialized","error");return}if(!(L!=null&&L.primaryValue)&&q!=="insert"){K(q==="delete"?"No row selected to delete":`No values provided to ${q}`,"error");return}f(!0),l.current.postMessage({action:q,payload:{table:j,columns:S.getState().columns,values:fe.getState().editValues,primaryValue:L==null?void 0:L.primaryValue}}),l.current.postMessage({action:"refresh",payload:{currentTable:j,offset:p,limit:h,filters:b,sorters:g}})},e[84]=j,e[85]=b,e[86]=h,e[87]=p,e[88]=L==null?void 0:L.primaryValue,e[89]=f,e[90]=g,e[91]=Re):Re=e[91];const ue=Re;let Oe;e[92]===Symbol.for("react.memo_cache_sentinel")?(Oe=()=>de(),e[92]=Oe):Oe=e[92],pe("ctrl+s",Oe);let Pe;e[93]!==ue?(Pe=()=>ue("insert"),e[93]=ue,e[94]=Pe):Pe=e[94],pe("ctrl+I",Pe,!0);let Ae;e[95]!==ue?(Ae=()=>ue("update"),e[95]=ue,e[96]=Ae):Ae=e[96],pe("ctrl+u",Ae);let Me;e[97]!==ue?(Me=()=>ue("delete"),e[97]=ue,e[98]=Me):Me=e[98],pe("ctrl+d",Me);let Fe;e[99]!==Ce?(Fe=()=>Ce(),e[99]=Ce,e[100]=Fe):Fe=e[100],pe("ctrl+q",Fe);let Ue;e[101]!==le?(Ue=()=>le("next"),e[101]=le,e[102]=Ue):Ue=e[102],pe("ctrl+ArrowRight",Ue);let qe;e[103]!==le?(qe=()=>le("first"),e[103]=le,e[104]=qe):qe=e[104],pe("ctrl+ArrowUp",qe);let He;e[105]!==le?(He=()=>le("last"),e[105]=le,e[106]=He):He=e[106],pe("ctrl+ArrowDown",He);let Be;e[107]!==le?(Be=()=>le("prev"),e[107]=le,e[108]=Be):Be=e[108],pe("ctrl+ArrowLeft",Be);let bt,Qe;e[109]!==ue||e[110]!==et||e[111]!==Z||e[112]!==G||e[113]!==le||e[114]!==Ce||e[115]!==se||e[116]!==he||e[117]!==te?(Qe={workerRef:l,handleFileUpload:G,handleFileChange:Z,handleDownload:de,handleTableChange:te,handleQueryFilter:se,handleQuerySorter:he,handlePageChange:le,handleExport:et,handleQueryExecute:Ce,handleEditSubmit:ue},e[109]=ue,e[110]=et,e[111]=Z,e[112]=G,e[113]=le,e[114]=Ce,e[115]=se,e[116]=he,e[117]=te,e[118]=Qe):Qe=e[118],bt=Qe;const tt=bt;let Ve;return e[119]!==s||e[120]!==tt?(Ve=a.jsx(Pt.Provider,{value:tt,children:s}),e[119]=s,e[120]=tt,e[121]=Ve):Ve=e[121],Ve};function wa(t){return t.setTablesSchema}function Sa(t){return t.setIndexesSchema}function Ca(t){return t.setCurrentTable}function Ea(t){return t.setData}function Ta(t){return t.setCustomQuery}function _a(t){return t.setColumns}function La(t){return t.setMaxSize}function Ia(t){return t.setIsDatabaseLoading}function $a(t){return t.setIsDataLoading}function za(t){return t.setErrorMessage}function Da(t){return t.filters}function ka(t){return t.sorters}function Ra(t){return t.limit}function Oa(t){return t.offset}function Pa(t){return t.currentTable}function Aa(t){return t.maxSize}function Ma(t){return t.setOffset}function Fa(t){return t.setFilters}function Ua(t){return t.setSorters}function qa(t){return t.setLimit}function Ha(t){return t.resetPagination}function Ba(t){return t.setCustomQueryObject}function Qa(t){return t.customQuery}function Va(t){return t.tablesSchema}function Wa(t){return t.name}function Ga(t){return t.name}function Ka(t){return t.trim()}function Xa(t){return t!==""}const Ya=t=>{const e=_.c(10),{children:s}=t,[l,r]=T.useState(null),[n,i]=T.useState(!1),o=l!==null||n;let d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=(j,v,w)=>{i(!1),r({data:j,index:v,primaryValue:w})},e[0]=d):d=e[0];const m=d;let c;e[1]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{r(null),i(!0)},e[1]=c):c=e[1];const u=c;let f;e[2]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{i(!1),r(null)},e[2]=f):f=e[2];const x=f;pe("ctrl+i",u,!0),pe("ctrl+`",x,!0);let b,g;e[3]!==o||e[4]!==n||e[5]!==l?(g={handleRowClick:m,handleInsert:u,handleCloseEdit:x,isEditing:o,selectedRowObject:l,isInserting:n,setIsInserting:i,setSelectedRowObject:r},e[3]=o,e[4]=n,e[5]=l,e[6]=g):g=e[6],b=g;const h=b;let p;return e[7]!==s||e[8]!==h?(p=a.jsx(Ot.Provider,{value:h,children:s}),e[7]=s,e[8]=h,e[9]=p):p=e[9],p},Ja=T.memo(function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("flex flex-col",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx(zs,{"data-slot":"tabs",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i});function Za(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center p-1",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx(Rs,{"data-slot":"tabs-list",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}const lt=_t.memo(function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("inline-flex flex-1 cursor-pointer items-center justify-center gap-1.5 rounded-md! px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow]","data-[state=active]:bg-white data-[state=active]:text-black","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring focus-visible:ring-[3px] focus-visible:outline-1","disabled:pointer-events-none disabled:opacity-50","[&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx(Ds,{"data-slot":"tabs-trigger",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i}),rt=_t.memo(function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("flex-1 outline-none",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx(ks,{"data-slot":"tabs-content",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i}),xe=()=>{const t=T.useContext(Pt);if(t===void 0)throw new Error("useDatabaseWorker must be used within a DatabaseWorkerProvider");return t},el=da("inline-flex cursor-pointer items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}}),tl=t=>{const e=_.c(18);let s,l,r,n,i,o;e[0]!==t?({className:s,variant:o,size:n,asChild:i,onClick:l,...r}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r,e[4]=n,e[5]=i,e[6]=o):(s=e[1],l=e[2],r=e[3],n=e[4],i=e[5],o=e[6]);const m=(i===void 0?!1:i)?Os:"button";let c;e[7]!==l?(c=h=>{l&&l(h)},e[7]=l,e[8]=c):c=e[8];const u=c;let f,x;e[9]!==s||e[10]!==n||e[11]!==o?(x=B(el({variant:o,size:n,className:s})),e[9]=s,e[10]=n,e[11]=o,e[12]=x):x=e[12],f=x;const b=f;let g;return e[13]!==m||e[14]!==b||e[15]!==u||e[16]!==r?(g=a.jsx(m,{"data-slot":"button",className:b,onClick:u,...r}),e[13]=m,e[14]=b,e[15]=u,e[16]=r,e[17]=g):g=e[17],g},P=tl,sl=t=>{const e=_.c(10);let s,l,r;e[0]!==t?({className:s,type:r,...l}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r):(s=e[1],l=e[2],r=e[3]);let n;e[4]!==s?(n=B("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-5 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),e[4]=s,e[5]=n):n=e[5];let i;return e[6]!==l||e[7]!==n||e[8]!==r?(i=a.jsx("input",{type:r,"data-slot":"input",className:n,...l}),e[6]=l,e[7]=n,e[8]=r,e[9]=i):i=e[9],i},ze=sl,At=()=>{const t=T.useContext(Rt);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t};function al(){const t=_.c(10),{theme:e,setTheme:s}=At();let l;t[0]!==s||t[1]!==e?(l=()=>s(e==="dark"?"light":"dark"),t[0]=s,t[1]=e,t[2]=l):l=t[2];const r=e==="dark"?"Switch to light mode":"Switch to dark mode",n=e==="dark"?"Switch to light mode":"Switch to dark mode";let i;t[3]!==e?(i=e==="dark"?a.jsx(ls,{className:"h-[1.2rem] w-[1.2rem]"}):a.jsx(rs,{className:"h-[1.2rem] w-[1.2rem]"}),t[3]=e,t[4]=i):i=t[4];let o;return t[5]!==l||t[6]!==r||t[7]!==n||t[8]!==i?(o=a.jsx(P,{variant:"outline",size:"sm",onClick:l,"aria-label":r,title:n,className:"border-foreground/25 relative flex items-center justify-center transition-transform duration-300",children:i}),t[5]=l,t[6]=r,t[7]=n,t[8]=i,t[9]=o):o=t[9],o}function Mt(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(Ps,{"data-slot":"select",...s}),e[2]=s,e[3]=l):l=e[3],l}function Ft(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(Ms,{"data-slot":"select-value",...s}),e[2]=s,e[3]=l):l=e[3],l}function Ut(t){const e=_.c(11);let s,l,r;e[0]!==t?({className:l,children:s,...r}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r):(s=e[1],l=e[2],r=e[3]);let n;e[4]!==l?(n=B("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive flex h-9 w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",l),e[4]=l,e[5]=n):n=e[5];let i;e[6]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsx(Hs,{asChild:!0,children:a.jsx(Ne,{className:"size-4 opacity-50"})}),e[6]=i):i=e[6];let o;return e[7]!==s||e[8]!==r||e[9]!==n?(o=a.jsxs(As,{"data-slot":"select-trigger",className:n,...r,children:[s,i]}),e[7]=s,e[8]=r,e[9]=n,e[10]=o):o=e[10],o}function qt(t){const e=_.c(20);let s,l,r,n;e[0]!==t?({className:l,children:s,position:n,...r}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r,e[4]=n):(s=e[1],l=e[2],r=e[3],n=e[4]);const i=n===void 0?"popper":n,o=i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1";let d;e[5]!==l||e[6]!==o?(d=B("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border shadow-md",o,l),e[5]=l,e[6]=o,e[7]=d):d=e[7];let m;e[8]===Symbol.for("react.memo_cache_sentinel")?(m=a.jsx(ll,{}),e[8]=m):m=e[8];const c=i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1";let u;e[9]!==c?(u=B("p-1",c),e[9]=c,e[10]=u):u=e[10];let f;e[11]!==s||e[12]!==u?(f=a.jsx(Bs,{className:u,children:s}),e[11]=s,e[12]=u,e[13]=f):f=e[13];let x;e[14]===Symbol.for("react.memo_cache_sentinel")?(x=a.jsx(rl,{}),e[14]=x):x=e[14];let b;return e[15]!==i||e[16]!==r||e[17]!==d||e[18]!==f?(b=a.jsx(Fs,{children:a.jsxs(Us,{"data-slot":"select-content",className:d,position:i,...r,children:[m,f,x]})}),e[15]=i,e[16]=r,e[17]=d,e[18]=f,e[19]=b):b=e[19],b}function Ht(t){const e=_.c(13);let s,l,r;e[0]!==t?({className:l,children:s,...r}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r):(s=e[1],l=e[2],r=e[3]);let n;e[4]!==l?(n=B("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",l),e[4]=l,e[5]=n):n=e[5];let i;e[6]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:a.jsx(Qs,{children:a.jsx(ns,{className:"size-4"})})}),e[6]=i):i=e[6];let o;e[7]!==s?(o=a.jsx(Vs,{children:s}),e[7]=s,e[8]=o):o=e[8];let d;return e[9]!==r||e[10]!==n||e[11]!==o?(d=a.jsxs(qs,{"data-slot":"select-item",className:n,...r,children:[i,o]}),e[9]=r,e[10]=n,e[11]=o,e[12]=d):d=e[12],d}const ll=function(e){const s=_.c(9);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("flex cursor-default items-center justify-center py-1",l),s[3]=l,s[4]=n):n=s[4];let i;s[5]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsx(Lt,{className:"size-4"}),s[5]=i):i=s[5];let o;return s[6]!==r||s[7]!==n?(o=a.jsx(Ws,{"data-slot":"select-scroll-up-button",className:n,...r,children:i}),s[6]=r,s[7]=n,s[8]=o):o=s[8],o};function rl(t){const e=_.c(9);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("flex cursor-default items-center justify-center py-1",s),e[3]=s,e[4]=r):r=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(Ne,{className:"size-4"}),e[5]=n):n=e[5];let i;return e[6]!==l||e[7]!==r?(i=a.jsx(Gs,{"data-slot":"select-scroll-down-button",className:r,...l,children:n}),e[6]=l,e[7]=r,e[8]=i):i=e[8],i}function nl(){const{handleFileChange:t,handleDownload:e,handleFileUpload:s}=xe(),[l,r]=T.useState(""),[n,i]=T.useState([]),o=async(d,m,c=0)=>{try{if(r(d),m=n.find(u=>u.name===d)||m,m){localStorage.setItem("currentDatabase",m.path),window.parent.postMessage({type:"requestUint8Array",path:m.path},"*");const u=await Promise.race([new Promise(b=>{window.addEventListener("message",g=>{g.data.type==="sendUint8Array"&&b(g.data.data)},{once:!0})}),new Promise((b,g)=>setTimeout(()=>g(new Error("Timeout")),5e3))]),f=new Uint8Array(u),x=new File([f],`${d}.sqlite`,{type:"application/x-sqlite3",lastModified:Date.now()});console.log("Received File:",x),s(x)}}catch(u){console.error("Failed to load database:",u),c<3&&setTimeout(()=>{o(d,m,c+1)},1e3)}};return T.useEffect(()=>{const m=new URLSearchParams(window.location.search).get("databases");if(m)try{const c=JSON.parse(decodeURIComponent(m));Array.isArray(c)&&(i(c),c.length>0&&setTimeout(()=>{o(c[0].name,c[0])},1e3))}catch(c){console.error("Failed to parse databases parameter:",c)}},[]),a.jsxs("header",{className:"flex items-center justify-between gap-2 border-b px-1 py-1.5",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[n.length>0&&a.jsxs(Mt,{value:l,onValueChange:d=>o(d,n.find(m=>m.name===d)),children:[a.jsx(Ut,{className:"border-primary/20 h-8 w-30 border text-sm sm:w-48",children:a.jsx(Ft,{placeholder:"选择数据库"})}),a.jsx(qt,{children:n.map(d=>a.jsx(Ht,{value:d.name,children:d.name},d.name))})]}),a.jsxs("label",{htmlFor:"file-upload",className:"relative cursor-pointer transition-opacity hover:opacity-80",children:[a.jsx(ze,{id:"file-upload",type:"file",className:"absolute inset-0 cursor-pointer opacity-0",onChange:d=>{t(d),localStorage.removeItem("currentDatabase"),r("")}}),a.jsxs(P,{size:"sm",variant:"outline",className:"border-foreground/25 pointer-events-none h-8 cursor-pointer px-3 text-xs font-medium sm:w-[200px]",children:[a.jsx(Te,{className:"mr-1.5 h-3.5 w-3.5"}),"Open Database"]})]}),a.jsxs(P,{size:"sm",variant:"outline",className:"border-foreground/25 h-8 px-3 text-xs font-medium",onClick:e,title:"Save the database",children:[a.jsx(It,{className:"mr-1.5 h-3.5 w-3.5"}),"Save Database"]})]}),a.jsx("div",{className:"flex items-center gap-1",children:a.jsx(al,{})})]})}const Le=mt(t=>({expandedTables:[],expandedIndexSection:!0,toggleTable:e=>t(s=>({expandedTables:s.expandedTables.includes(e)?s.expandedTables.filter(r=>r!==e):[...s.expandedTables,e]})),setExpandedTables:e=>t(()=>({expandedTables:e})),toggleExpandedIndexSection:()=>t(e=>({expandedIndexSection:!e.expandedIndexSection})),setExpandedIndexSection:e=>t(()=>({expandedIndexSection:e}))})),Y=T.memo(function(e){const s=_.c(3),{children:l,className:r}=e,n=`block max-w-80 overflow-hidden text-ellipsis ${r??""}`;let i;return s[0]!==l||s[1]!==n?(i=a.jsx("span",{className:n,children:l}),s[0]=l,s[1]=n,s[2]=i):i=s[2],i}),il={DATE:/DATE|TIMESTAMP/i,BLOB:/^BLOB$/i,TEXT:/CHAR|TEXT|CLOB|VARCHAR/i,INTEGER:/INT/i,REAL:/REAL|FLOAT|DOUBLE|DECIMAL/i,NUMERIC:/NUMERIC/i,BOOLEAN:/BOOL/i},Se=(t,e)=>il[e].test(t),Bt=t=>Se(t,"DATE"),ol=t=>Se(t,"BLOB"),Qt=t=>Se(t,"TEXT"),cl=t=>Se(t,"NUMERIC"),dl=t=>Se(t,"BOOLEAN"),ml=t=>Se(t,"INTEGER"),ul=t=>Se(t,"REAL"),Vt=t=>ml(t)||ul(t)||cl(t);function pt(t){const e=_.c(12),{columnSchema:s}=t;if(!s)return null;const{type:l,isPrimaryKey:r,isForeignKey:n}=s;let i;e[0]!==l?(i=()=>l?ol(l)?a.jsx(is,{className:"h-4 w-4 text-green-500"}):Bt(l)?a.jsx(os,{className:"h-4 w-4 text-blue-500"}):Qt(l)?a.jsx(cs,{className:"h-4 w-4 text-indigo-500"}):Vt(l)?a.jsx(ds,{className:"h-4 w-4 text-red-500"}):dl(l)?a.jsx(ms,{className:"h-4 w-4 text-pink-500"}):a.jsx(us,{className:"h-4 w-4 text-gray-500"}):null,e[0]=l,e[1]=i):i=e[1];const o=i;let d;e[2]!==o?(d=o(),e[2]=o,e[3]=d):d=e[3];const m=d;let c;e[4]!==r?(c=r&&a.jsx(fs,{className:"h-4 w-4 text-yellow-500"}),e[4]=r,e[5]=c):c=e[5];let u;e[6]!==n?(u=n&&a.jsx(xs,{className:"h-4 w-4 text-purple-500"}),e[6]=n,e[7]=u):u=e[7];let f;return e[8]!==c||e[9]!==u||e[10]!==m?(f=a.jsxs("div",{className:"flex items-center gap-[2px]",children:[c,u,m]}),e[8]=c,e[9]=u,e[10]=m,e[11]=f):f=e[11],f}const fl=T.memo(t=>{const e=_.c(12),{columnSchema:s}=t;let l;e[0]!==s?(l=a.jsx(pt,{columnSchema:s}),e[0]=s,e[1]=l):l=e[1];let r;e[2]!==s.name?(r=a.jsx("span",{className:"text-primary/60 ml-1 text-xs",children:s.name}),e[2]=s.name,e[3]=r):r=e[3];let n;e[4]!==l||e[5]!==r?(n=a.jsxs("div",{className:"flex items-center",children:[l,r]}),e[4]=l,e[5]=r,e[6]=n):n=e[6];let i;e[7]!==s.type?(i=a.jsx(Y,{className:"text-primary/60 text-xs whitespace-nowrap",children:a.jsx("span",{className:"text-primary/50 bg-primary/5 rounded-full px-2 py-0.5 text-xs",children:s.type})}),e[7]=s.type,e[8]=i):i=e[8];let o;return e[9]!==n||e[10]!==i?(o=a.jsxs("div",{className:"flex items-center justify-between gap-1",children:[n,i]}),e[9]=n,e[10]=i,e[11]=o):o=e[11],o}),xl=T.memo(Ne),pl=T.memo(Ie),Wt=T.memo(t=>{const e=_.c(4),{expanded:s,size:l}=t,r=l===void 0?4:l,n=`h-${r} w-${r}`;if(s){let o;return e[0]!==n?(o=a.jsx(xl,{className:n}),e[0]=n,e[1]=o):o=e[1],o}let i;return e[2]!==n?(i=a.jsx(pl,{className:n}),e[2]=n,e[3]=i):i=e[3],i}),hl=T.memo(t=>{const e=_.c(26),{name:s,table:l,expanded:r,toggleTable:n}=t;let i;e[0]!==s||e[1]!==n?(i=()=>n(s),e[0]=s,e[1]=n,e[2]=i):i=e[2];const o=i,d=r&&"ml-1";let m;e[3]!==d?(m=B("flex cursor-pointer items-center rounded px-1.5 py-1 transition-all hover:ml-2",d),e[3]=d,e[4]=m):m=e[4];let c;e[5]!==r?(c=a.jsx("div",{className:"flex h-5 w-5 items-center justify-center",children:a.jsx(Wt,{expanded:r})}),e[5]=r,e[6]=c):c=e[6];let u;e[7]!==s?(u=a.jsx("span",{className:"text-sm",children:s}),e[7]=s,e[8]=u):u=e[8];let f;e[9]!==l.schema.length?(f=a.jsxs("span",{className:"text-primary/50 text-xs",children:["(",l.schema.length,")"]}),e[9]=l.schema.length,e[10]=f):f=e[10];let x;e[11]!==u||e[12]!==f?(x=a.jsxs("span",{className:"flex items-center gap-1 capitalize",children:[u,f]}),e[11]=u,e[12]=f,e[13]=x):x=e[13];let b;e[14]!==r||e[15]!==o||e[16]!==m||e[17]!==c||e[18]!==x?(b=a.jsxs("button",{className:m,onClick:o,"aria-expanded":r,children:[c,x]}),e[14]=r,e[15]=o,e[16]=m,e[17]=c,e[18]=x,e[19]=b):b=e[19];let g;e[20]!==r||e[21]!==l.schema?(g=r&&a.jsx("div",{className:"border-primary/20 mt-1 mb-2 ml-4 flex flex-col gap-1 space-y-0.5 border-l-2 pl-2",children:l.schema.map(bl)}),e[20]=r,e[21]=l.schema,e[22]=g):g=e[22];let h;return e[23]!==b||e[24]!==g?(h=a.jsxs("article",{children:[b,g]}),e[23]=b,e[24]=g,e[25]=h):h=e[25],h});function bl(t){return a.jsx(fl,{columnSchema:t},t.cid)}const Gt=T.memo(t=>{const e=_.c(17),{title:s,expanded:l,icon:r,onToggle:n,children:i}=t;let o;e[0]!==n?(o=b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),n())},e[0]=n,e[1]=o):o=e[1];const d=o,m=!l&&"mb-0";let c;e[2]!==m?(c=B("hover:bg-primary/5 bg-primary/7 flex cursor-pointer items-center px-2 py-2 transition-colors",m),e[2]=m,e[3]=c):c=e[3];let u;e[4]!==l?(u=a.jsx("div",{className:"flex h-5 w-5 items-center justify-center",children:a.jsx(Wt,{expanded:l,size:5})}),e[4]=l,e[5]=u):u=e[5];let f;e[6]!==s?(f=a.jsx(Y,{className:"flex items-center gap-1",children:s}),e[6]=s,e[7]=f):f=e[7];let x;return e[8]!==i||e[9]!==l||e[10]!==d||e[11]!==r||e[12]!==n||e[13]!==c||e[14]!==u||e[15]!==f?(x=a.jsxs("header",{className:c,role:"button",tabIndex:0,onClick:n,onKeyDown:d,"aria-expanded":l,children:[u,r,f,i]}),e[8]=i,e[9]=l,e[10]=d,e[11]=r,e[12]=n,e[13]=c,e[14]=u,e[15]=f,e[16]=x):x=e[16],x}),gl=T.memo(t=>{const e=_.c(23),{tablesSchema:s,expandAllTables:l,collapseAllTables:r,expandedTableSection:n,toggleTableSection:i,expandedTables:o,toggleTable:d}=t,[m,c]=T.useState(!1);let u;e[0]!==l||e[1]!==s?(u=N=>{N.stopPropagation(),l(s),c(!0)},e[0]=l,e[1]=s,e[2]=u):u=e[2];const f=u;let x;e[3]!==r?(x=N=>{N.stopPropagation(),r(),c(!1)},e[3]=r,e[4]=x):x=e[4];const b=x;let g;e[5]!==n||e[6]!==b||e[7]!==f||e[8]!==m?(g=n&&a.jsx("div",{className:"ml-auto flex",children:m?a.jsx(P,{className:"text-primary hover:bg-primary/5 h-7 rounded px-2 py-0.5 text-xs transition-colors",variant:"ghost",size:"icon",onClick:b,"aria-label":"Collapse all tables",children:a.jsx(ps,{className:"h-4 w-4"})}):a.jsx(P,{className:"text-primary hover:bg-primary/5 h-7 rounded px-2 py-0.5 text-xs transition-colors",variant:"ghost",size:"icon",onClick:f,"aria-label":"Expand all tables",children:a.jsx(hs,{className:"h-4 w-4"})})}),e[5]=n,e[6]=b,e[7]=f,e[8]=m,e[9]=g):g=e[9];const h=g;let p;e[10]===Symbol.for("react.memo_cache_sentinel")?(p=a.jsx(Te,{className:"mr-2 h-4 w-4"}),e[10]=p):p=e[10];let j;e[11]!==h||e[12]!==n||e[13]!==i?(j=a.jsx(Gt,{title:"Tables",expanded:n,icon:p,onToggle:i,children:h}),e[11]=h,e[12]=n,e[13]=i,e[14]=j):j=e[14];let v;e[15]!==n||e[16]!==o||e[17]!==s||e[18]!==d?(v=n&&a.jsx("div",{className:"space-y-0.5 overflow-y-auto pr-1 pl-2",children:Object.entries(s).map(N=>{const[E,z]=N;return a.jsx(hl,{name:E,table:z,expanded:o.includes(E),toggleTable:d},E)})}),e[15]=n,e[16]=o,e[17]=s,e[18]=d,e[19]=v):v=e[19];let w;return e[20]!==j||e[21]!==v?(w=a.jsxs("section",{children:[j,v]}),e[20]=j,e[21]=v,e[22]=w):w=e[22],w}),yl=T.memo(t=>{const e=_.c(7),{index:s}=t;let l;e[0]!==s.name?(l=a.jsx("span",{className:"text-sm",children:s.name}),e[0]=s.name,e[1]=l):l=e[1];let r;e[2]!==s.tableName?(r=a.jsx(Y,{className:"text-primary/60 text-xs font-medium whitespace-nowrap",children:a.jsx("span",{className:"text-primary/50 bg-primary/5 rounded-full px-2 py-0.5 text-xs",children:s.tableName})}),e[2]=s.tableName,e[3]=r):r=e[3];let n;return e[4]!==l||e[5]!==r?(n=a.jsx("article",{children:a.jsx("div",{className:"flex cursor-pointer items-center rounded px-1.5 py-1 transition-all hover:ml-2",children:a.jsxs("div",{className:"flex w-full items-center justify-between gap-1",children:[l,r]})})}),e[4]=l,e[5]=r,e[6]=n):n=e[6],n}),jl=T.memo(t=>{const e=_.c(10),{indexes:s,expandedIndexSection:l,toggleIndexSection:r}=t;let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(bs,{className:"mr-2 h-4 w-4"}),e[0]=n):n=e[0];let i;e[1]!==l||e[2]!==r?(i=a.jsx(Gt,{title:"Indexes",expanded:l,icon:n,onToggle:r}),e[1]=l,e[2]=r,e[3]=i):i=e[3];let o;e[4]!==l||e[5]!==s?(o=l&&a.jsx("div",{className:"space-y-0.5 overflow-y-auto pr-1 pl-2",children:s.map(Nl)}),e[4]=l,e[5]=s,e[6]=o):o=e[6];let d;return e[7]!==i||e[8]!==o?(d=a.jsxs("section",{children:[i,o]}),e[7]=i,e[8]=o,e[9]=d):d=e[9],d});function Nl(t){return a.jsx(yl,{index:t},t.name)}const vl=T.memo(t=>{const e=_.c(3),{onFilterChange:s}=t;let l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=a.jsx(gs,{className:"text-primary/40 absolute top-1/2 left-2 h-4 w-4 -translate-y-1/2 transform"}),e[0]=l):l=e[0];let r;return e[1]!==s?(r=a.jsxs("div",{className:"relative",children:[l,a.jsx(ze,{placeholder:"Search tables and indexes",className:"border-primary/20 h-8 w-full pl-8 text-sm text-[0.8rem]!",onChange:n=>s(n.target.value),"aria-label":"Search tables and indexes"})]}),e[1]=s,e[2]=r):r=e[2],r}),ht=()=>{const t=_.c(29),[e,s]=T.useState(""),[l,r]=T.useState(!0),n=Le(wl),i=Le(Sl),o=S(Cl),d=S(El),m=Le(Tl),c=Le(_l),u=Le(Ll);let f;t[0]===Symbol.for("react.memo_cache_sentinel")?(f=()=>{r(Il)},t[0]=f):f=t[0];const x=f;let b;t[1]!==u?(b=y=>{u(Object.keys(y)),r(!0)},t[1]=u,t[2]=b):b=t[2];const g=b;let h;t[3]!==u?(h=()=>{u([]),r(!1)},t[3]=u,t[4]=h):h=t[4];const p=h;let j;e:{if(!e){j=o;break e}let y;if(t[5]!==e||t[6]!==o){y={};for(const[$,L]of Object.entries(o))$.toLowerCase().includes(e.toLowerCase())&&(y[$]=L);t[5]=e,t[6]=o,t[7]=y}else y=t[7];j=y}const v=j;let w;e:{if(!e){w=d;break e}let y;if(t[8]!==e||t[9]!==d){let $;t[11]!==e?($=L=>L.name.toLowerCase().includes(e.toLowerCase())||L.tableName.toLowerCase().includes(e.toLowerCase()),t[11]=e,t[12]=$):$=t[12],y=d.filter($),t[8]=e,t[9]=d,t[10]=y}else y=t[10];w=y}const N=w;let E;t[13]===Symbol.for("react.memo_cache_sentinel")?(E=a.jsx("div",{className:"bg-primary/5 border-b p-2",children:a.jsx(vl,{onFilterChange:s})}),t[13]=E):E=t[13];let z;t[14]!==p||t[15]!==g||t[16]!==l||t[17]!==m||t[18]!==v||t[19]!==c?(z=a.jsx(gl,{tablesSchema:v,expandedTableSection:l,toggleTableSection:x,expandAllTables:g,collapseAllTables:p,expandedTables:m,toggleTable:c}),t[14]=p,t[15]=g,t[16]=l,t[17]=m,t[18]=v,t[19]=c,t[20]=z):z=t[20];let C;t[21]!==n||t[22]!==N||t[23]!==d.length||t[24]!==i?(C=d.length>0&&a.jsx(jl,{indexes:N,expandedIndexSection:n,toggleIndexSection:i}),t[21]=n,t[22]=N,t[23]=d.length,t[24]=i,t[25]=C):C=t[25];let I;return t[26]!==z||t[27]!==C?(I=a.jsxs("section",{className:"flex h-full w-full flex-col overflow-hidden",children:[E,a.jsxs("nav",{className:"flex-1 overflow-auto",children:[z,C]})]}),t[26]=z,t[27]=C,t[28]=I):I=t[28],I};function wl(t){return t.expandedIndexSection}function Sl(t){return t.toggleExpandedIndexSection}function Cl(t){return t.tablesSchema}function El(t){return t.indexesSchema}function Tl(t){return t.expandedTables}function _l(t){return t.toggleTable}function Ll(t){return t.setExpandedTables}function Il(t){return!t}const $l=()=>{const t=_.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=a.jsx("div",{className:"h-full overflow-y-auto",children:a.jsx(ht,{})}),t[0]=e):e=t[0],e};function ot(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("flex h-full w-full data-[panel-group-direction=vertical]:flex-col",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx(fa,{"data-slot":"resizable-panel-group",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function Ee(t){const e=_.c(2);let s;return e[0]!==t?(s=a.jsx(ma,{"data-slot":"resizable-panel",...t}),e[0]=t,e[1]=s):s=e[1],s}function ct(t){const e=_.c(12);let s,l,r;e[0]!==t?({withHandle:r,className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r):(s=e[1],l=e[2],r=e[3]);let n;e[4]!==s?(n=B("bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",s),e[4]=s,e[5]=n):n=e[5];let i;e[6]!==r?(i=r&&a.jsx("div",{className:"bg-border border-primary/20 z-50 flex h-9 w-4 items-center justify-center rounded-xs border",children:a.jsx(ys,{className:"size-2.5"})}),e[6]=r,e[7]=i):i=e[7];let o;return e[8]!==l||e[9]!==n||e[10]!==i?(o=a.jsx(ua,{"data-slot":"resizable-handle",className:n,...l,children:i}),e[8]=l,e[9]=n,e[10]=i,e[11]=o):o=e[11],o}function zl(){const t=_.c(7),{handleTableChange:e}=xe(),s=S(Rl),r=S(kl)??void 0;let n;t[0]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(Ut,{className:"border-primary/20 h-8 w-30 border text-sm sm:w-48",children:a.jsx(Ft,{placeholder:"Select Table"})}),t[0]=n):n=t[0];let i;t[1]!==s?(i=a.jsx(qt,{children:Object.keys(s).map(Dl)}),t[1]=s,t[2]=i):i=t[2];let o;return t[3]!==e||t[4]!==r||t[5]!==i?(o=a.jsxs(Mt,{onValueChange:e,value:r,children:[n,i]}),t[3]=e,t[4]=r,t[5]=i,t[6]=o):o=t[6],o}function Dl(t){return a.jsx(Ht,{value:t,children:a.jsx(Y,{className:"text-[0.8rem]! capitalize",children:t})},t)}function kl(t){return t.currentTable}function Rl(t){return t.tablesSchema}function Kt(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx("textarea",{"data-slot":"textarea",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function Ol(){var O;const t=_.c(46),{handleEditSubmit:e}=xe(),{selectedRowObject:s,isInserting:l,handleCloseEdit:r}=ve(),n=fe(Hl),i=fe(ql),o=S(Ul),d=S(Fl),m=S(Ml);let c,u;t[0]!==m||t[1]!==l||t[2]!==s||t[3]!==i?(c=()=>{l?i((m==null?void 0:m.map(Al))||[]):s&&i(s.data.map(Pl))},u=[l,s,m,i],t[0]=m,t[1]=l,t[2]=s,t[3]=i,t[4]=c,t[5]=u):(c=t[4],u=t[5]),T.useEffect(c,u);let f;t[6]!==i?(f=(A,M)=>{const F=fe.getState().editValues;i(F.map((U,X)=>X===A?M:U))},t[6]=i,t[7]=f):f=t[7];const x=f;let b;e:{if(!m||!d||!o[d]){b=null;break e}const A=(O=o[d])==null?void 0:O.schema;let M;if(t[8]!==m||t[9]!==n||t[10]!==x||t[11]!==A){let F;t[13]!==n||t[14]!==x||t[15]!==A?(F=(U,X)=>{const Q=A[X],G=(Q==null?void 0:Q.dflt_value)||"Null",J=(()=>{const Z=(Q==null?void 0:Q.type)??"";return Vt(Z)?"number":Bt(Z)?"date":"text"})();return a.jsxs("div",{className:"border-primary/10 border shadow-sm",children:[a.jsx("label",{htmlFor:U,className:"bg-primary/5 border-primary/10 flex items-center gap-1 border-b p-1.5",children:a.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1.5",children:[a.jsx(pt,{columnSchema:Q}),a.jsx(Y,{className:"text-xs font-medium capitalize",children:U})]}),Q.IsNullable&&a.jsx("span",{className:"text-primary/50 bg-primary/5 rounded-full px-2 py-0.5 text-xs",children:"Nullable"})]})}),a.jsx("div",{className:"p-1",children:Qt((Q==null?void 0:Q.type)??"")?a.jsx(Kt,{id:U,name:U,className:"border-primary/20 focus:ring-primary/30 focus:border-primary/40 rounded border text-sm text-[0.8rem]! focus:ring-1",value:n[X]||"",onChange:Z=>x(X,Z.target.value),placeholder:G}):a.jsx(ze,{id:U,name:U,type:J,className:"border-primary/20 focus:ring-primary/30 focus:border-primary/40 h-9 rounded border text-[0.8rem]! focus:ring-1",value:n[X]||"",onChange:Z=>x(X,Z.target.value),placeholder:G})})]},U)},t[13]=n,t[14]=x,t[15]=A,t[16]=F):F=t[16],M=m.map(F),t[8]=m,t[9]=n,t[10]=x,t[11]=A,t[12]=M}else M=t[12];b=M}const g=b;let h,p;t[17]!==e||t[18]!==l?(p=()=>e(l?"insert":"update"),t[17]=e,t[18]=l,t[19]=p):p=t[19];const j=l?"Insert row":"Apply changes";let v;t[20]!==l?(v=l?a.jsxs(a.Fragment,{children:[a.jsx(Ke,{className:"mr-2 h-3.5 w-3.5"}),"Insert row"]}):a.jsxs(a.Fragment,{children:[a.jsx(Xe,{className:"mr-2 h-3.5 w-3.5"}),"Apply changes"]}),t[20]=l,t[21]=v):v=t[21];let w;t[22]!==p||t[23]!==j||t[24]!==v?(w=a.jsx(P,{size:"sm",variant:"outline",className:"w-full py-2 text-xs font-medium",onClick:p,"aria-label":j,children:v}),t[22]=p,t[23]=j,t[24]=v,t[25]=w):w=t[25];let N;t[26]!==e||t[27]!==l?(N=!l&&a.jsx(P,{size:"sm",variant:"destructive",className:"hover:bg-destructive/50 rounded text-xs",onClick:()=>e("delete"),"aria-label":"Delete row",children:a.jsx($t,{className:"h-3.5 w-3.5"})}),t[26]=e,t[27]=l,t[28]=N):N=t[28];let E;t[29]!==w||t[30]!==N?(E=a.jsxs("div",{className:"bg-primary/5 border-primary/10 flex w-full gap-1 border-t p-2 shadow-inner",children:[w,N]}),t[29]=w,t[30]=N,t[31]=E):E=t[31],h=E;const z=h;let C,I;t[32]!==l?(I=a.jsx("div",{className:"flex items-center gap-2",children:l?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-primary/10 rounded p-1.5",children:a.jsx(Ke,{className:"h-4 w-4"})}),a.jsx(Y,{className:"text-sm font-medium whitespace-nowrap",children:"Inserting new row"})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-primary/10 rounded p-1.5",children:a.jsx(Xe,{className:"h-4 w-4"})}),a.jsx(Y,{className:"text-sm font-medium whitespace-nowrap",children:"Updating row"})]})}),t[32]=l,t[33]=I):I=t[33];let y;t[34]===Symbol.for("react.memo_cache_sentinel")?(y=a.jsx(ut,{className:"mr-1 h-3 w-3"}),t[34]=y):y=t[34];let $;t[35]!==r?($=a.jsxs(P,{size:"sm",variant:"outline",className:"text-xs",onClick:r,title:"Go back to data","aria-label":"Go back to data",children:[y,"Back"]}),t[35]=r,t[36]=$):$=t[36];let L;t[37]!==I||t[38]!==$?(L=a.jsxs("div",{className:"bg-primary/5 sticky top-0 z-10 flex w-full items-center justify-between gap-1 border-b p-2 shadow-sm",children:[I,$]}),t[37]=I,t[38]=$,t[39]=L):L=t[39],C=L;const D=C;let R;t[40]!==g?(R=a.jsx("div",{className:"flex-1 overflow-auto",children:g}),t[40]=g,t[41]=R):R=t[41];let k;return t[42]!==z||t[43]!==D||t[44]!==R?(k=a.jsxs("section",{className:"flex h-full flex-col",children:[D,R,z]}),t[42]=z,t[43]=D,t[44]=R,t[45]=k):k=t[45],k}function Pl(t){return(t==null?void 0:t.toString())??""}function Al(){return""}function Ml(t){return t.columns}function Fl(t){return t.currentTable}function Ul(t){return t.tablesSchema}function ql(t){return t.setEditValues}function Hl(t){return t.editValues}const Bl=function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("w-full caption-bottom text-sm",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:a.jsx("table",{"data-slot":"table",className:n,...r})}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i},Ql=function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("[&_tr]:border-b",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx("thead",{"data-slot":"table-header",id:"tableHeader",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i},Vl=function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("[&_tr:last-child]:border-0",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx("tbody",{"data-slot":"table-body",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i},nt=function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx("tr",{"data-slot":"table-row",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i},wt=function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("text-muted-foreground min-h-6 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx("th",{"data-slot":"table-head",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i},St=function(e){const s=_.c(8);let l,r;s[0]!==e?({className:l,...r}=e,s[0]=e,s[1]=l,s[2]=r):(l=s[1],r=s[2]);let n;s[3]!==l?(n=B("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",l),s[3]=l,s[4]=n):n=s[4];let i;return s[5]!==r||s[6]!==n?(i=a.jsx("td",{"data-slot":"table-cell",id:"tableCell",className:n,...r}),s[5]=r,s[6]=n,s[7]=i):i=s[7],i};function Wl(t){const e=_.c(17),{column:s,value:l,onChange:r,debounceTime:n}=t,i=n===void 0?300:n,[o,d]=T.useState(l);let m,c;e[0]!==l?(m=()=>{d(l)},c=[l],e[0]=l,e[1]=m,e[2]=c):(m=e[1],c=e[2]),T.useEffect(m,c);let u,f;e[3]!==r?(f=(N,E)=>{r(N,E)},e[3]=r,e[4]=f):f=e[4];let x;e[5]!==i||e[6]!==f?(x=it.debounce(f,i),e[5]=i,e[6]=f,e[7]=x):x=e[7],u=x;const g=u;let h;e[8]!==s||e[9]!==g?(h=N=>{const E=N.target.value;d(E),g(s,E)},e[8]=s,e[9]=g,e[10]=h):h=e[10];const p=h;let j,v;e[11]!==g?(j=()=>()=>{g.cancel()},v=[g],e[11]=g,e[12]=j,e[13]=v):(j=e[12],v=e[13]),T.useEffect(j,v);let w;return e[14]!==p||e[15]!==o?(w=a.jsx(ze,{type:"text",className:"border-primary/20 max-h-6 w-full rounded px-2 py-1 text-[0.8rem]",value:o,onChange:p,placeholder:"Filter"}),e[14]=p,e[15]=o,e[16]=w):w=e[16],w}function dt(t){const e=_.c(2),{children:s}=t;let l;return e[0]!==s?(l=a.jsx("span",{className:"text-muted-foreground bg-primary/5 rounded px-2 py-0.5 text-xs italic",children:s}),e[0]=s,e[1]=l):l=e[1],l}const Gl=T.memo(t=>{const e=_.c(18),{column:s}=t,l=S(Kl),{handleQuerySorter:r}=xe();if(l!=null&&l[s])if(l[s]==="asc"){let d;e[0]!==s||e[1]!==r?(d=()=>r(s),e[0]=s,e[1]=r,e[2]=d):d=e[2];let m;e[3]===Symbol.for("react.memo_cache_sentinel")?(m=a.jsx(js,{className:"h-3 w-3"}),e[3]=m):m=e[3];let c;return e[4]!==d?(c=a.jsx("button",{title:"Sort column in descending order",type:"button","aria-label":"Sort descending",className:"cursor-pointer",onClick:d,children:m}),e[4]=d,e[5]=c):c=e[5],c}else{let d;e[6]!==s||e[7]!==r?(d=()=>r(s),e[6]=s,e[7]=r,e[8]=d):d=e[8];let m;e[9]===Symbol.for("react.memo_cache_sentinel")?(m=a.jsx(Ns,{className:"h-3 w-3"}),e[9]=m):m=e[9];let c;return e[10]!==d?(c=a.jsx("button",{title:"Sort column in ascending order",type:"button","aria-label":"Sort ascending",className:"cursor-pointer",onClick:d,children:m}),e[10]=d,e[11]=c):c=e[11],c}let n;e[12]!==s||e[13]!==r?(n=()=>r(s),e[12]=s,e[13]=r,e[14]=n):n=e[14];let i;e[15]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsx(vs,{className:"h-3 w-3"}),e[15]=i):i=e[15];let o;return e[16]!==n?(o=a.jsx("button",{title:"Sort column in ascending order",type:"button","aria-label":"Sort column",className:"cursor-pointer",onClick:n,children:i}),e[16]=n,e[17]=o):o=e[17],o});function Kl(t){return t.sorters}function Xt({mode:t,data:e,columns:s,enableFilters:l=!0,enableSorting:r=!0,enableEditing:n=!0,emptyMessage:i="No Data To Show",emptyDescription:o="No data to display"}){const d=S(y=>y.data),m=S(y=>y.columns),c=S(y=>y.customQueryObject),u=S(y=>y.currentTable),f=S(y=>y.tablesSchema),x=S(y=>y.filters),b=S(y=>y.setFilters),g=S(y=>y.queryOffset),h=S(y=>y.queryLimit),{handleQueryFilter:p}=xe(),{handleRowClick:j}=ve(),v=S(y=>y.sorters),w=T.useMemo(()=>t==="browse"?d:e||(c==null?void 0:c.data)||null,[t,d,e,c==null?void 0:c.data]),N=T.useMemo(()=>t==="browse"?m:s||(c==null?void 0:c.columns)||null,[t,m,s,c==null?void 0:c.columns]),E=T.useMemo(()=>{if(!w||t==="browse")return w;let y=[...w];if(x&&Object.keys(x).length>0&&N&&(y=y.filter(L=>Object.entries(x).every(([D,R])=>{if(!R)return!0;const k=N.findIndex(A=>A===D);if(k===-1)return!0;const O=L[k];return O===null?!1:String(O).toLowerCase().includes(R.toLowerCase())}))),v&&Object.keys(v).length>0&&N){const L=Object.entries(v);y.sort((D,R)=>{for(const[k,O]of L){const A=N.findIndex(X=>X===k);if(A===-1)continue;const M=D[A],F=R[A];if(M===null&&F===null)continue;if(M===null)return O==="asc"?-1:1;if(F===null)return O==="asc"?1:-1;let U=0;if(typeof M=="string"&&typeof F=="string"?U=M.localeCompare(F):typeof M=="number"&&typeof F=="number"?U=M-F:U=String(M).localeCompare(String(F)),U!==0)return O==="asc"?U:-U}return 0})}return y.slice(g,g+h)},[w,t,v,x,N,g,h]),z=T.useMemo(()=>{if(n)return(y,$,L)=>{j(y,$,L)}},[n,j]),C=T.useMemo(()=>a.jsx("div",{className:"flex h-full flex-col items-center justify-center gap-1 px-4",children:x&&l?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"mb-1 font-medium",children:i}),a.jsx("p",{className:"text-muted-foreground max-w-md text-sm",children:"当前过滤条件没有返回任何结果"})]}),a.jsxs(P,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>b(null),children:[a.jsx(ft,{className:"mr-1 h-3 w-3"}),"清除过滤器"]})]}):a.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-4 p-8",children:[a.jsx("div",{className:"bg-primary/10 rounded-full p-4",children:a.jsx(Te,{className:"text-primary/70 h-8 w-8"})}),a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"mb-1 font-medium",children:i}),a.jsx("p",{className:"text-muted-foreground max-w-md text-sm",children:o})]})]})}),[x,l,i,o,b]),I=T.useMemo(()=>l?(N||[]).map(y=>a.jsx(Wl,{column:y,value:(x==null?void 0:x[y])??"",onChange:p},y)):[],[N,x,p,l]);return a.jsxs(Bl,{children:[a.jsx(Ql,{children:a.jsx(nt,{className:"bg-primary/5",children:N&&(t!=="browse"||u)?N.map((y,$)=>a.jsxs(wt,{className:"p-1 text-xs",children:[a.jsxs("div",{className:"flex items-center gap-1 py-[1.5px]",children:[r&&a.jsx(Gl,{column:y}),a.jsx(Y,{className:"text-foreground font-medium capitalize",children:y}),t==="browse"&&u&&f[u]&&a.jsx(pt,{columnSchema:f[u].schema[$]})]}),l&&(I==null?void 0:I[$])]},y)):a.jsx(wt,{children:a.jsx("p",{className:"text-xs",children:"No columns found"})})})}),a.jsx(Vl,{children:E&&E.length>0?E.map((y,$)=>{const L=t==="browse"?y.slice(1):y,D=t==="browse"?y[0]:y[0]||$;return a.jsx(nt,{onClick:z?()=>z(L,$,D):void 0,className:`text-xs ${n?"hover:bg-primary/5 focus:bg-primary/5 cursor-pointer":""}`,children:L.map((R,k)=>{var O,A,M;return a.jsx(St,{className:"border-primary/5 border-t p-2",children:R===null?a.jsx(dt,{children:"NULL"}):a.jsx(a.Fragment,{children:t==="browse"&&u&&((M=(A=(O=f==null?void 0:f[u])==null?void 0:O.schema)==null?void 0:A[k])==null?void 0:M.type)==="BLOB"?a.jsx(dt,{children:"BLOB"}):a.jsx(Y,{className:"text-xs",children:String(R)})})},k)})},$)}):a.jsx(nt,{children:a.jsx(St,{colSpan:(N==null?void 0:N.length)??1,className:"h-32 text-center",children:C})})})]})}function Xl(){const t=_.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=a.jsx(Xt,{mode:"browse",enableFilters:!0,enableSorting:!0,enableEditing:!0,emptyMessage:"No Data To Show",emptyDescription:"This table does not have any data to display"}),t[0]=e):e=t[0],e}function Ye(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(Zs,{"data-slot":"dropdown-menu",...s}),e[2]=s,e[3]=l):l=e[3],l}function Je(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(Ks,{"data-slot":"dropdown-menu-trigger",...s}),e[2]=s,e[3]=l):l=e[3],l}function Ze(t){const e=_.c(10);let s,l,r;e[0]!==t?({className:s,sideOffset:r,...l}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r):(s=e[1],l=e[2],r=e[3]);const n=r===void 0?4:r;let i;e[4]!==s?(i=B("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",s),e[4]=s,e[5]=i):i=e[5];let o;return e[6]!==l||e[7]!==n||e[8]!==i?(o=a.jsx(Ys,{children:a.jsx(Js,{"data-slot":"dropdown-menu-content",sideOffset:n,className:i,...l})}),e[6]=l,e[7]=n,e[8]=i,e[9]=o):o=e[9],o}function me(t){const e=_.c(12);let s,l,r,n;e[0]!==t?({className:s,inset:l,variant:n,...r}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r,e[4]=n):(s=e[1],l=e[2],r=e[3],n=e[4]);const i=n===void 0?"default":n;let o;e[5]!==s?(o=B("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),e[5]=s,e[6]=o):o=e[6];let d;return e[7]!==l||e[8]!==r||e[9]!==o||e[10]!==i?(d=a.jsx(Xs,{"data-slot":"dropdown-menu-item","data-inset":l,"data-variant":i,className:o,...r}),e[7]=l,e[8]=r,e[9]=o,e[10]=i,e[11]=d):d=e[11],d}function Ct(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(ta,{"data-slot":"dropdown-menu-sub",...s}),e[2]=s,e[3]=l):l=e[3],l}function Et(t){const e=_.c(13);let s,l,r,n;e[0]!==t?({className:l,inset:r,children:s,...n}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r,e[4]=n):(s=e[1],l=e[2],r=e[3],n=e[4]);let i;e[5]!==l?(i=B("focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",l),e[5]=l,e[6]=i):i=e[6];let o;e[7]===Symbol.for("react.memo_cache_sentinel")?(o=a.jsx(Ie,{className:"ml-auto size-4"}),e[7]=o):o=e[7];let d;return e[8]!==s||e[9]!==r||e[10]!==n||e[11]!==i?(d=a.jsxs(ea,{"data-slot":"dropdown-menu-sub-trigger","data-inset":r,className:i,...n,children:[s,o]}),e[8]=s,e[9]=r,e[10]=n,e[11]=i,e[12]=d):d=e[12],d}function Tt(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx(sa,{"data-slot":"dropdown-menu-sub-content",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function Yt(t){const e=_.c(57),{mode:s,totalSize:l,enableInsert:r,enableExport:n}=t,i=r===void 0?!0:r,o=n===void 0?!0:n,{handlePageChange:d,handleExport:m}=xe(),{isInserting:c,handleInsert:u}=ve(),f=S(ar),x=S(sr),b=S(tr),g=S(er),h=S(Zl),p=S(Jl),j=S(Yl),v=s==="browse"?f:g,w=s==="browse"?x:h,N=s==="browse"?b:l||0;let E;e[0]!==w||e[1]!==N||e[2]!==v||e[3]!==p?(E=he=>{if(N)if(typeof he=="number")p(he);else if(he==="next"){const be=v+w;be>=N?N-w<0&&p(0):p(be)}else if(he==="prev"){const be=v-w;be<0?p(0):p(be)}else he==="first"?p(0):he==="last"&&(N-w<0?p(0):p(N-w))},e[0]=w,e[1]=N,e[2]=v,e[3]=p,e[4]=E):E=e[4];const C=s==="browse"?d:E,I=s==="browse"?"current":"custom";let y;e[5]!==w||e[6]!==N||e[7]!==v?(y=N>0&&a.jsxs(a.Fragment,{children:["Rows ",v+1," - ",Math.min(v+w,N)," of"," ",N]}),e[5]=w,e[6]=N,e[7]=v,e[8]=y):y=e[8];let $;e[9]!==y?($=a.jsx("section",{className:"flex items-center gap-1 p-2",children:a.jsx("span",{className:"text-muted-foreground text-xs",children:y})}),e[9]=y,e[10]=$):$=e[10];let L;e[11]!==C?(L=()=>C("first"),e[11]=C,e[12]=L):L=e[12];const D=v===0||j||!N;let R;e[13]===Symbol.for("react.memo_cache_sentinel")?(R=a.jsx(ws,{className:"h-4 w-4"}),e[13]=R):R=e[13];let k;e[14]!==L||e[15]!==D?(k=a.jsx(P,{onClick:L,disabled:D,size:"icon",variant:"ghost",className:"h-8 w-8 rounded-l-md rounded-r-none border-r",title:"Go to first page",children:R}),e[14]=L,e[15]=D,e[16]=k):k=e[16];let O;e[17]!==C?(O=()=>C("prev"),e[17]=C,e[18]=O):O=e[18];const A=v===0||j||!N;let M;e[19]===Symbol.for("react.memo_cache_sentinel")?(M=a.jsx(ut,{className:"h-4 w-4"}),e[19]=M):M=e[19];let F;e[20]!==O||e[21]!==A?(F=a.jsx(P,{onClick:O,disabled:A,size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none border-r",title:"Go to previous page",children:M}),e[20]=O,e[21]=A,e[22]=F):F=e[22];let U;e[23]!==C?(U=()=>C("next"),e[23]=C,e[24]=U):U=e[24];const X=v+w>=N||j||!N;let Q;e[25]===Symbol.for("react.memo_cache_sentinel")?(Q=a.jsx(Ie,{className:"h-4 w-4"}),e[25]=Q):Q=e[25];let G;e[26]!==U||e[27]!==X?(G=a.jsx(P,{onClick:U,disabled:X,size:"icon",variant:"ghost",className:"h-8 w-8 rounded-none border-r",title:"Go to next page",children:Q}),e[26]=U,e[27]=X,e[28]=G):G=e[28];let J;e[29]!==C?(J=()=>C("last"),e[29]=C,e[30]=J):J=e[30];const Z=v+w>=N||j||!N;let ne;e[31]===Symbol.for("react.memo_cache_sentinel")?(ne=a.jsx(Ss,{className:"h-4 w-4"}),e[31]=ne):ne=e[31];let de;e[32]!==J||e[33]!==Z?(de=a.jsx(P,{onClick:J,disabled:Z,size:"icon",variant:"ghost",className:"h-8 w-8 rounded-l-none rounded-r-md border-l",title:"Go to last page",children:ne}),e[32]=J,e[33]=Z,e[34]=de):de=e[34];let ae;e[35]!==F||e[36]!==G||e[37]!==de||e[38]!==k?(ae=a.jsx("section",{className:"flex items-center gap-1 p-2",children:a.jsxs("div",{className:"flex items-center gap-0",children:[k,F,G,de]})}),e[35]=F,e[36]=G,e[37]=de,e[38]=k,e[39]=ae):ae=e[39];let te;e[40]!==i||e[41]!==u||e[42]!==c||e[43]!==N||e[44]!==s?(te=i&&s==="browse"&&a.jsxs(P,{size:"sm",variant:"outline",className:"h-8 text-xs font-medium shadow-sm",onClick:u,disabled:c||!N,children:[a.jsx(Ke,{className:"mr-2 h-3.5 w-3.5"}),"Insert row"]}),e[40]=i,e[41]=u,e[42]=c,e[43]=N,e[44]=s,e[45]=te):te=e[45];let ee;e[46]!==o||e[47]!==I||e[48]!==m?(ee=o&&a.jsxs(Ye,{children:[a.jsx(Je,{asChild:!0,children:a.jsxs(P,{size:"sm",variant:"outline",className:"h-8 text-xs font-medium shadow-sm",onClick:()=>m(I,"csv"),title:"Export data as CSV (click) or hover for more options",children:[a.jsx($e,{className:"mr-2 h-3.5 w-3.5"}),"Export data",a.jsx(Ne,{className:"ml-1 h-3 w-3 opacity-50"})]})}),a.jsxs(Ze,{className:"w-32",children:[a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>m(I,"csv"),children:"Export as CSV"})}),a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>m(I,"txt"),children:"Export as TXT"})})]})]}),e[46]=o,e[47]=I,e[48]=m,e[49]=ee):ee=e[49];let se;e[50]!==te||e[51]!==ee?(se=a.jsxs("section",{className:"bg-primary/10 hidden h-full items-center gap-1 p-2 md:flex",children:[te,ee]}),e[50]=te,e[51]=ee,e[52]=se):se=e[52];let ie;return e[53]!==ae||e[54]!==se||e[55]!==$?(ie=a.jsxs("footer",{className:"bg-background flex w-full items-center justify-between border-t shadow-sm",id:"paginationControls",children:[$,ae,se]}),e[53]=ae,e[54]=se,e[55]=$,e[56]=ie):ie=e[56],ie}function Yl(t){return t.isDataLoading}function Jl(t){return t.setQueryOffset}function Zl(t){return t.queryLimit}function er(t){return t.queryOffset}function tr(t){return t.maxSize}function sr(t){return t.limit}function ar(t){return t.offset}function lr(){const t=_.c(1);let e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=a.jsx(Yt,{mode:"browse",enableInsert:!0,enableExport:!0}),t[0]=e):e=t[0],e}function rr(t){const e=_.c(41),{setFilters:s,setSorters:l,filters:r,sorters:n}=t,{isInserting:i,handleInsert:o}=ve(),{handleExport:d}=xe();let m;e[0]===Symbol.for("react.memo_cache_sentinel")?(m=a.jsx(Je,{asChild:!0,children:a.jsxs(P,{variant:"outline",size:"sm",className:"h-8 text-xs",children:["Actions ",a.jsx(Ne,{className:"ml-1 h-3 w-3"})]})}),e[0]=m):m=e[0];let c;e[1]!==s?(c=()=>s(null),e[1]=s,e[2]=c):c=e[2];const u=r==null;let f;e[3]===Symbol.for("react.memo_cache_sentinel")?(f=a.jsx(ft,{className:"mr-1 h-3 w-3"}),e[3]=f):f=e[3];let x;e[4]!==c||e[5]!==u?(x=a.jsx(me,{asChild:!0,children:a.jsxs(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:c,disabled:u,title:"Clear applied filters",children:[f,"Clear filters"]})}),e[4]=c,e[5]=u,e[6]=x):x=e[6];let b;e[7]!==l?(b=()=>l(null),e[7]=l,e[8]=b):b=e[8];const g=n==null;let h;e[9]===Symbol.for("react.memo_cache_sentinel")?(h=a.jsx(zt,{className:"mr-1 h-3 w-3"}),e[9]=h):h=e[9];let p;e[10]!==b||e[11]!==g?(p=a.jsx(me,{asChild:!0,children:a.jsxs(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:b,disabled:g,title:"Reset sorting",children:[h,"Reset sorting"]})}),e[10]=b,e[11]=g,e[12]=p):p=e[12];let j;e[13]===Symbol.for("react.memo_cache_sentinel")?(j=a.jsx(Ke,{className:"mr-1 h-3 w-3"}),e[13]=j):j=e[13];let v;e[14]!==o||e[15]!==i?(v=a.jsx(me,{asChild:!0,children:a.jsxs(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:o,disabled:i,title:"Insert a new row",children:[j,"Insert row"]})}),e[14]=o,e[15]=i,e[16]=v):v=e[16];let w;e[17]===Symbol.for("react.memo_cache_sentinel")?(w=a.jsx($e,{className:"mr-1 h-3 w-3"}),e[17]=w):w=e[17];let N;e[18]===Symbol.for("react.memo_cache_sentinel")?(N=a.jsxs(Et,{className:"h-8 text-xs",children:[w,"Export table",a.jsx(Ie,{className:"ml-auto h-3 w-3"})]}),e[18]=N):N=e[18];let E;e[19]!==d?(E=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>d("table","csv"),children:"Export as CSV"})}),e[19]=d,e[20]=E):E=e[20];let z;e[21]!==d?(z=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>d("table","txt"),children:"Export as TXT"})}),e[21]=d,e[22]=z):z=e[22];let C;e[23]!==E||e[24]!==z?(C=a.jsxs(Ct,{children:[N,a.jsxs(Tt,{className:"w-32",children:[E,z]})]}),e[23]=E,e[24]=z,e[25]=C):C=e[25];let I;e[26]===Symbol.for("react.memo_cache_sentinel")?(I=a.jsx($e,{className:"mr-1 h-3 w-3"}),e[26]=I):I=e[26];let y;e[27]===Symbol.for("react.memo_cache_sentinel")?(y=a.jsxs(Et,{className:"h-8 text-xs",children:[I,"Export data",a.jsx(Ie,{className:"ml-auto h-3 w-3"})]}),e[27]=y):y=e[27];let $;e[28]!==d?($=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>d("current","csv"),children:"Export as CSV"})}),e[28]=d,e[29]=$):$=e[29];let L;e[30]!==d?(L=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>d("current","txt"),children:"Export as TXT"})}),e[30]=d,e[31]=L):L=e[31];let D;e[32]!==$||e[33]!==L?(D=a.jsxs(Ct,{children:[y,a.jsxs(Tt,{className:"w-32",children:[$,L]})]}),e[32]=$,e[33]=L,e[34]=D):D=e[34];let R;return e[35]!==v||e[36]!==C||e[37]!==D||e[38]!==x||e[39]!==p?(R=a.jsxs(Ye,{children:[m,a.jsxs(Ze,{className:"w-40",children:[x,p,v,C,D]})]}),e[35]=v,e[36]=C,e[37]=D,e[38]=x,e[39]=p,e[40]=R):R=e[40],R}function nr(t){const e=_.c(19),{exportType:s}=t,{handleExport:l}=xe();let r;e[0]!==s||e[1]!==l?(r=()=>l(s,"csv"),e[0]=s,e[1]=l,e[2]=r):r=e[2];let n;e[3]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx($e,{className:"mr-1 h-3 w-3"}),e[3]=n):n=e[3];let i;e[4]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsx(Ne,{className:"ml-1 h-3 w-3 opacity-50"}),e[4]=i):i=e[4];let o;e[5]!==r?(o=a.jsx(Je,{asChild:!0,children:a.jsxs(P,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:r,onContextMenu:ir,title:"Export as CSV (click) or hover for more options",children:[n,"Export table",i]})}),e[5]=r,e[6]=o):o=e[6];let d;e[7]!==s||e[8]!==l?(d=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>l(s,"csv"),children:"Export as CSV"})}),e[7]=s,e[8]=l,e[9]=d):d=e[9];let m;e[10]!==s||e[11]!==l?(m=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:()=>l(s,"txt"),children:"Export as TXT"})}),e[10]=s,e[11]=l,e[12]=m):m=e[12];let c;e[13]!==d||e[14]!==m?(c=a.jsxs(Ze,{className:"w-32",children:[d,m]}),e[13]=d,e[14]=m,e[15]=c):c=e[15];let u;return e[16]!==o||e[17]!==c?(u=a.jsxs(Ye,{children:[o,c]}),e[16]=o,e[17]=c,e[18]=u):u=e[18],u}function ir(t){t.preventDefault()}function or(t){const e=_.c(24),{filters:s,sorters:l}=t,r=S(dr),n=S(cr);let i;e[0]!==r?(i=()=>r(null),e[0]=r,e[1]=i):i=e[1];const o=s==null;let d;e[2]===Symbol.for("react.memo_cache_sentinel")?(d=a.jsx(ft,{className:"mr-1 h-3 w-3"}),e[2]=d):d=e[2];let m;e[3]!==i||e[4]!==o?(m=a.jsxs(P,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:i,disabled:o,title:"Clear applied filters",children:[d,"Clear filters"]}),e[3]=i,e[4]=o,e[5]=m):m=e[5];let c;e[6]!==n?(c=()=>n(null),e[6]=n,e[7]=c):c=e[7];const u=l==null;let f;e[8]===Symbol.for("react.memo_cache_sentinel")?(f=a.jsx(zt,{className:"mr-1 h-3 w-3"}),e[8]=f):f=e[8];let x;e[9]!==c||e[10]!==u?(x=a.jsxs(P,{size:"sm",variant:"outline",className:"h-8 text-xs",onClick:c,disabled:u,title:"Reset sorting",children:[f,"Reset sorting"]}),e[9]=c,e[10]=u,e[11]=x):x=e[11];let b;e[12]===Symbol.for("react.memo_cache_sentinel")?(b=a.jsx(nr,{exportType:"table"}),e[12]=b):b=e[12];let g;e[13]!==m||e[14]!==x?(g=a.jsxs("div",{className:"hidden items-center gap-1 md:flex",children:[m,x,b]}),e[13]=m,e[14]=x,e[15]=g):g=e[15];let h;e[16]!==s||e[17]!==r||e[18]!==n||e[19]!==l?(h=a.jsx("div",{className:"md:hidden",children:a.jsx(rr,{setFilters:r,setSorters:n,filters:s,sorters:l})}),e[16]=s,e[17]=r,e[18]=n,e[19]=l,e[20]=h):h=e[20];let p;return e[21]!==g||e[22]!==h?(p=a.jsxs(a.Fragment,{children:[g,h]}),e[21]=g,e[22]=h,e[23]=p):p=e[23],p}function cr(t){return t.setSorters}function dr(t){return t.setFilters}function mr(){const t=_.c(36),e=S(wr),s=S(vr),l=S(Nr),r=S(jr),n=fe(yr),i=fe(gr),o=fe(br),d=fe(hr),{isEditing:m}=ve(),c=S(pr),u=S(xr),f=S(fr),x=S(ur);let b,g;t[0]!==f||t[1]!==u||t[2]!==c||t[3]!==x?(b=()=>{const k=()=>{if(console.log("resize",u,f),u>f){let O=c+f;O>=u&&(O=0),x(O),setTimeout(()=>{x(0)},50)}};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)},g=[c,f,u,x],t[0]=f,t[1]=u,t[2]=c,t[3]=x,t[4]=b,t[5]=g):(b=t[4],g=t[5]),T.useEffect(b,g);let h;t[6]===Symbol.for("react.memo_cache_sentinel")?(h=a.jsx(zl,{}),t[6]=h):h=t[6];let p;t[7]!==e||t[8]!==s?(p=a.jsx(or,{filters:e,sorters:s}),t[7]=e,t[8]=s,t[9]=p):p=t[9];let j;t[10]!==l||t[11]!==r?(j=(l||r)&&a.jsxs("span",{className:"ml-2 flex items-center text-xs text-gray-500",children:[a.jsx(xt,{className:"mr-1 h-3 w-3 animate-spin"}),"Loading data"]}),t[10]=l,t[11]=r,t[12]=j):j=t[12];let v;t[13]!==p||t[14]!==j?(v=a.jsxs("div",{className:"flex items-center gap-1 border-b px-1 py-2",children:[h,p,j]}),t[13]=p,t[14]=j,t[15]=v):v=t[15];let w;t[16]===Symbol.for("react.memo_cache_sentinel")?(w=a.jsxs("div",{className:"flex h-full flex-col justify-between border-l",id:"dataSection",children:[a.jsx(Xl,{}),a.jsx(lr,{})]}),t[16]=w):w=t[16];let N;t[17]!==n||t[18]!==o?(N=a.jsx(Ee,{id:"dataPanel",defaultSize:n,onResize:o,children:w}),t[17]=n,t[18]=o,t[19]=N):N=t[19];let E;t[20]===Symbol.for("react.memo_cache_sentinel")?(E=a.jsx(ct,{className:"hidden md:flex",withHandle:!0}),t[20]=E):E=t[20];const z=`static md:relative md:block ${m?"block":"hidden"}`;let C;t[21]===Symbol.for("react.memo_cache_sentinel")?(C=a.jsx("div",{className:"h-full overflow-hidden",children:a.jsx("div",{className:"h-full overflow-y-auto",children:a.jsx(ht,{})})}),t[21]=C):C=t[21];const I=`bg-background absolute top-0 right-0 z-40 h-full w-full ${m?"block":"hidden"}`;let y;t[22]===Symbol.for("react.memo_cache_sentinel")?(y=a.jsx("section",{className:"bg-primary/5 h-full",children:a.jsx(Ol,{})}),t[22]=y):y=t[22];let $;t[23]!==I?($=a.jsx("div",{className:I,children:y}),t[23]=I,t[24]=$):$=t[24];let L;t[25]!==i||t[26]!==d||t[27]!==$||t[28]!==z?(L=a.jsxs(Ee,{id:"schemaPanel",defaultSize:i,onResize:d,className:z,children:[C,$]}),t[25]=i,t[26]=d,t[27]=$,t[28]=z,t[29]=L):L=t[29];let D;t[30]!==L||t[31]!==N?(D=a.jsx("div",{className:"relative h-full overflow-hidden",children:a.jsxs(ot,{direction:"horizontal",className:"h-full",children:[N,E,L]})}),t[30]=L,t[31]=N,t[32]=D):D=t[32];let R;return t[33]!==D||t[34]!==v?(R=a.jsxs("div",{className:"flex h-full flex-col",children:[v,D]}),t[33]=D,t[34]=v,t[35]=R):R=t[35],R}function ur(t){return t.setOffset}function fr(t){return t.limit}function xr(t){return t.maxSize}function pr(t){return t.offset}function hr(t){return t.setSchemaPanelSize}function br(t){return t.setDataPanelSize}function gr(t){return t.schemaPanelSize}function yr(t){return t.dataPanelSize}function jr(t){return t.isDatabaseLoading}function Nr(t){return t.isDataLoading}function vr(t){return t.sorters}function wr(t){return t.filters}const Sr=["ABORT","ACTION","ADD","AFTER","ALL","ALTER","ANALYZE","AND","AS","ASC","ATTACH","AUTOINCREMENT","BEFORE","BEGIN","BETWEEN","BY","CASCADE","CASE","CAST","CHECK","COLLATE","COLUMN","COMMIT","CONFLICT","CONSTRAINT","CREATE","CROSS","CURRENT_DATE","CURRENT_TIME","CURRENT_TIMESTAMP","DATABASE","DEFAULT","DEFERRABLE","DEFERRED","DELETE","DESC","DETACH","DISTINCT","DROP","EACH","ELSE","END","ESCAPE","EXCEPT","EXCLUSIVE","EXISTS","EXPLAIN","FAIL","FOR","FOREIGN","FROM","FULL","GLOB","GROUP","HAVING","IF","IGNORE","IMMEDIATE","IN","INDEX","INDEXED","INITIALLY","INNER","INSERT","INSTEAD","INTERSECT","INTO","IS","ISNULL","JOIN","KEY","LEFT","LIKE","LIMIT","MATCH","NATURAL","NO","NOT","NOTNULL","NULL","OF","OFFSET","ON","OR","ORDER","OUTER","PLAN","PRAGMA","PRIMARY","QUERY","RAISE","RECURSIVE","REFERENCES","REGEXP","REINDEX","RELEASE","RENAME","REPLACE","RESTRICT","RIGHT","ROLLBACK","ROW","SAVEPOINT","SELECT","SET","TABLE","TEMP","TEMPORARY","THEN","TO","TRANSACTION","TRIGGER","UNION","UNIQUE","UPDATE","USING","VACUUM","VALUES","VIEW","VIRTUAL","WHEN","WHERE","WITH","WITHOUT"],Cr=["ABS","ACOS","ASIN","ATAN","CEIL","COS","EXP","FLOOR","HEX","LENGTH","LOG","LOWER","LTRIM","OCT","PI","POW","ROUND","SIGN","SIN","SQRT","TAN","TRIM","UPPER"];function Er(){const{theme:t}=At(),e=S(c=>c.customQuery),s=S(c=>c.setCustomQuery),l=S(c=>c.tablesSchema),{tableNames:r,columnNames:n}=T.useMemo(()=>{const c=Object.keys(l),u=c.flatMap(f=>l[f].schema.map(x=>x.name));return{tableNames:c,columnNames:u}},[l]),i=T.useMemo(()=>[...Sr.map(c=>({label:c,type:"keyword"})),...Cr.map(c=>({label:c,type:"function"})),...r.map(c=>({label:c,type:"table"})),...n.map(c=>({label:c,type:"column"}))],[r,n]),o=T.useCallback(c=>{const u=c.matchBefore(/\w*/);return!u||u.from===u.to&&!c.explicit?null:{from:u.from,to:u.to,options:i}},[i]),d=T.useCallback(c=>{c!==e&&s(c)},[e,s]),m=T.useMemo(()=>[ha,ba(),ga({override:[o]})],[o]);return a.jsx(xa,{value:e||"",height:"100%",extensions:m,onChange:d,className:"h-full w-full",theme:t==="dark"?pa:"light"})}function Tr(t,e){const s=_.c(19),l=S($r),r=S(Ir),n=S(Lr),i=S(_r);let o;e:{if(!t||!e){let p;s[0]===Symbol.for("react.memo_cache_sentinel")?(p=[],s[0]=p):p=s[0];let j;s[1]===Symbol.for("react.memo_cache_sentinel")?(j={processedData:p,totalSize:0,paginatedData:[]},s[1]=j):j=s[1],o=j;break e}let f;if(s[2]!==e||s[3]!==l||s[4]!==t||s[5]!==r){if(f=[...t],l&&Object.keys(l).length>0&&(f=f.filter(p=>Object.entries(l).every(j=>{const[v,w]=j;if(!w)return!0;const N=e.findIndex(z=>z===v);if(N===-1)return!0;const E=p[N];return E===null?!1:String(E).toLowerCase().includes(w.toLowerCase())}))),r&&Object.keys(r).length>0){const p=Object.entries(r);f.sort((j,v)=>{for(const[w,N]of p){const E=e.findIndex(y=>y===w);if(E===-1)continue;const z=j[E],C=v[E];if(z===null&&C===null)continue;if(z===null)return N==="asc"?-1:1;if(C===null)return N==="asc"?1:-1;let I;if(typeof z=="string"&&typeof C=="string"?I=z.localeCompare(C):typeof z=="number"&&typeof C=="number"?I=z-C:I=String(z).localeCompare(String(C)),I!==0)return N==="asc"?I:-I}return 0})}s[2]=e,s[3]=l,s[4]=t,s[5]=r,s[6]=f}else f=s[6];const x=f.length;let b;s[7]!==f||s[8]!==i||s[9]!==n?(b=f.slice(n,n+i),s[7]=f,s[8]=i,s[9]=n,s[10]=b):b=s[10];const g=b;let h;s[11]!==g||s[12]!==f||s[13]!==x?(h={processedData:f,totalSize:x,paginatedData:g},s[11]=g,s[12]=f,s[13]=x,s[14]=h):h=s[14],o=h}const{processedData:d,totalSize:m,paginatedData:c}=o;let u;return s[15]!==c||s[16]!==d||s[17]!==m?(u={processedData:d,totalSize:m,paginatedData:c},s[15]=c,s[16]=d,s[17]=m,s[18]=u):u=s[18],u}function _r(t){return t.queryLimit}function Lr(t){return t.queryOffset}function Ir(t){return t.sorters}function $r(t){return t.filters}function zr(){const t=_.c(26),e=S(Dr),{totalSize:s}=Tr((e==null?void 0:e.data)||null,(e==null?void 0:e.columns)||null);if(!e){let c;t[0]===Symbol.for("react.memo_cache_sentinel")?(c=a.jsx("div",{className:"bg-primary/10 rounded-full p-4",children:a.jsx(Te,{className:"text-primary/70 h-8 w-8"})}),t[0]=c):c=t[0];let u;return t[1]===Symbol.for("react.memo_cache_sentinel")?(u=a.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-4 p-8",children:[c,a.jsxs("div",{className:"text-center",children:[a.jsx("h3",{className:"mb-1 font-medium",children:"No Query Results"}),a.jsx("p",{className:"text-muted-foreground max-w-md text-sm",children:"Execute a SQL query to view the results here"})]})]}),t[1]=u):u=t[1],u}if(!e.data||e.data.length===0){let c,u;t[2]===Symbol.for("react.memo_cache_sentinel")?(c=a.jsx(Ge,{className:"text-primary/70 h-4 w-4"}),u=a.jsx("h3",{className:"text-sm font-medium",children:"Query Results"}),t[2]=c,t[3]=u):(c=t[2],u=t[3]);let f;t[4]!==e.columns.length?(f=a.jsx("div",{className:"bg-primary/5 border-b p-3",children:a.jsxs("div",{className:"flex items-center gap-2",children:[c,u,a.jsxs("span",{className:"bg-primary/10 rounded-full px-2 py-0.5 text-xs",children:[e.columns.length," columns"]})]})}),t[4]=e.columns.length,t[5]=f):f=t[5];let x;t[6]===Symbol.for("react.memo_cache_sentinel")?(x=a.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[a.jsx("div",{className:"bg-primary/5 mb-4 rounded-full p-4",children:a.jsx(Ge,{className:"text-primary/50 h-6 w-6"})}),a.jsx("p",{className:"text-md mb-1 font-medium",children:"Query returned no results"}),a.jsx("p",{className:"text-muted-foreground text-sm",children:"Your query executed successfully but returned no data"})]}),t[6]=x):x=t[6];let b;return t[7]!==f?(b=a.jsxs("div",{className:"h-full shadow-sm",children:[f,x]}),t[7]=f,t[8]=b):b=t[8],b}let l;t[9]===Symbol.for("react.memo_cache_sentinel")?(l=a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ge,{className:"text-primary/70 h-4 w-4"}),a.jsx(Y,{className:"mr-2 text-sm font-medium text-nowrap",children:"Query Results"})]}),t[9]=l):l=t[9];let r;t[10]!==s?(r=a.jsxs(Y,{className:"bg-primary/10 rounded-full px-2 py-0.5 text-xs text-nowrap",children:[s," total rows"]}),t[10]=s,t[11]=r):r=t[11];let n;t[12]!==e.columns.length?(n=a.jsxs(Y,{className:"bg-primary/10 rounded-full px-2 py-0.5 text-xs text-nowrap",children:[e.columns.length," columns"]}),t[12]=e.columns.length,t[13]=n):n=t[13];let i;t[14]!==r||t[15]!==n?(i=a.jsx("div",{className:"bg-primary/5 flex-shrink-0 border-b p-3",children:a.jsxs("div",{className:"flex items-center justify-between",children:[l,a.jsxs("div",{className:"flex items-center gap-2",children:[r,n]})]})}),t[14]=r,t[15]=n,t[16]=i):i=t[16];let o;t[17]!==e.columns||t[18]!==e.data?(o=a.jsx("div",{className:"h-0 min-h-0 flex-grow overflow-hidden",children:a.jsx(Xt,{mode:"query",data:e.data,columns:e.columns,enableFilters:!0,enableSorting:!0,enableEditing:!0,emptyMessage:"Query returned no results",emptyDescription:"Your query executed successfully but returned no data"})}),t[17]=e.columns,t[18]=e.data,t[19]=o):o=t[19];let d;t[20]!==s?(d=a.jsx(Yt,{mode:"query",totalSize:s,enableInsert:!1,enableExport:!0}),t[20]=s,t[21]=d):d=t[21];let m;return t[22]!==i||t[23]!==o||t[24]!==d?(m=a.jsxs("div",{className:"flex h-full w-full flex-col shadow-sm",children:[i,o,d]}),t[22]=i,t[23]=o,t[24]=d,t[25]=m):m=t[25],m}function Dr(t){return t.customQueryObject}function kr(){const t=_.c(29),[e,s]=T.useState(!1),l=S(Ar),r=S(Pr),n=S(Or),i=S(Rr);let o;t[0]!==i?(o=E=>{i(E)},t[0]=i,t[1]=o):o=t[1];const d=o;let m;t[2]!==r?(m=(E,z)=>{z.stopPropagation(),r(E)},t[2]=r,t[3]=m):m=t[3];const c=m;let u;t[4]!==n?(u=()=>{n()},t[4]=n,t[5]=u):u=t[5];const f=u;let x;t[6]!==e?(x=()=>{s(!e)},t[6]=e,t[7]=x):x=t[7];const b=x;if(l.length===0)return null;let g;t[8]===Symbol.for("react.memo_cache_sentinel")?(g=a.jsx(Ts,{className:"h-3 w-3"}),t[8]=g):g=t[8];let h;t[9]!==e?(h=e?a.jsx(Lt,{className:"h-3 w-3"}):a.jsx(Ne,{className:"h-3 w-3"}),t[9]=e,t[10]=h):h=t[10];let p;t[11]!==l.length||t[12]!==h||t[13]!==b?(p=a.jsxs(P,{variant:"ghost",size:"sm",onClick:b,className:"flex items-center gap-2 text-xs font-medium",children:[g,"SQL 历史记录 (",l.length,")",h]}),t[11]=l.length,t[12]=h,t[13]=b,t[14]=p):p=t[14];let j;t[15]!==f||t[16]!==e?(j=e&&a.jsx(P,{variant:"ghost",size:"sm",onClick:f,className:"text-xs text-destructive hover:text-destructive",title:"清空所有历史记录",children:a.jsx($t,{className:"h-3 w-3"})}),t[15]=f,t[16]=e,t[17]=j):j=t[17];let v;t[18]!==p||t[19]!==j?(v=a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b",children:[p,j]}),t[18]=p,t[19]=j,t[20]=v):v=t[20];let w;t[21]!==c||t[22]!==d||t[23]!==e||t[24]!==l?(w=e&&a.jsx("div",{className:"max-h-48 overflow-y-auto",children:l.map(E=>a.jsxs("div",{className:"group flex items-start gap-2 px-3 py-2 hover:bg-muted/50 border-b border-border/50 cursor-pointer",onClick:()=>d(E.query),children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-xs font-mono text-foreground/90 break-all mb-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:E.query}),a.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[a.jsx(Cs,{className:"h-3 w-3"}),E.executedAt]})]}),a.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[a.jsx(P,{variant:"ghost",size:"sm",onClick:()=>d(E.query),className:"h-6 w-6 p-0",title:"使用此查询",children:a.jsx(Dt,{className:"h-3 w-3"})}),a.jsx(P,{variant:"ghost",size:"sm",onClick:z=>c(E.id,z),className:"h-6 w-6 p-0 text-destructive hover:text-destructive",title:"删除此记录",children:a.jsx(Es,{className:"h-3 w-3"})})]})]},E.id))}),t[21]=c,t[22]=d,t[23]=e,t[24]=l,t[25]=w):w=t[25];let N;return t[26]!==v||t[27]!==w?(N=a.jsxs("div",{className:"border-t bg-background",children:[v,w]}),t[26]=v,t[27]=w,t[28]=N):N=t[28],N}function Rr(t){return t.useSqlFromHistory}function Or(t){return t.clearSqlHistory}function Pr(t){return t.removeSqlHistory}function Ar(t){return t.sqlHistory}function Mr(t){if(!t)return null;const s=t.replace(/--.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ").trim().toLowerCase().match(/select\s+.*?\s+from\s+([a-zA-Z_][a-zA-Z0-9_]*)/);return s?s[1]:null}function Fr(t){if(!t)return!1;const e=t.replace(/--.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ").trim().toLowerCase();return!["join","union","group by","having","distinct","order by","limit","offset","case when","exists","in (select"].some(l=>e.includes(l))}function Ur({title:t="编辑查询结果"}){const{selectedRowObject:e,handleCloseEdit:s}=ve(),{handleQueryExecute:l,workerRef:r}=xe(),n=S(C=>C.customQueryObject),i=S(C=>C.customQuery),o=S(C=>C.tablesSchema),[d,m]=T.useState([]),[c,u]=T.useState(!1),[f,x]=T.useState(!1),[b,g]=T.useState(null),h=(n==null?void 0:n.columns)||null,p=T.useMemo(()=>Mr(i||""),[i]),j=T.useMemo(()=>!i||!p||!(o&&p in o)?!1:Fr(i),[i,p,o]);T.useEffect(()=>{e&&h&&m(e.data.map(C=>(C==null?void 0:C.toString())??""))},[e,h]);const v=T.useCallback((C,I)=>{m(y=>y.map(($,L)=>L===C?I:$))},[]),w=T.useCallback(async()=>{if(!e||!h||!p||!j){console.warn("无法保存：缺少必要信息或查询不可编辑"),g("无法保存：缺少必要信息或查询不可编辑");return}if(!o||!(p in o)){const C=`表 "${p}" 不存在于数据库架构中，无法编辑`;console.error(C),g(C);return}x(!0),g(null);try{const C=o[p],I=C.primaryKey;console.log("表信息:",{tableName:p,primaryKeyName:I,tableSchema:C.schema,columns:h,editValues:d});const y=h.map((k,O)=>{const A=d[O];if(A===null||A===""||A==="NULL")return`"${k}" = NULL`;const M=/^-?\d+(\.\d+)?$/.test(A);return`"${k}" = ${M?A:`'${A.replace(/'/g,"''")}'`}`}).join(", ");let $,L;if(I==="_rowid_"){const k=h.findIndex(O=>O.toLowerCase()==="rowid");k!==-1?($=e.data[k],L=`rowid = ${$}`):L=h.map((A,M)=>{const F=e.data[M];return F===null?`"${A}" IS NULL`:typeof F=="string"?`"${A}" = '${F.replace(/'/g,"''")}'`:`"${A}" = ${F}`}).join(" AND ")}else{const k=h.findIndex(O=>O===I);if(k===-1)throw new Error(`主键列 "${I}" 在查询结果中未找到`);$=e.data[k],L=typeof $=="string"?`"${I}" = '${$.replace(/'/g,"''")}'`:`"${I}" = ${$}`}const D=`UPDATE "${p}" SET ${y} WHERE ${L}`;console.log("执行更新查询:",D),await new Promise((k,O)=>{if(!r.current){O(new Error("Worker 未初始化"));return}const A=setTimeout(()=>{O(new Error("更新操作超时"))},5e3),M=F=>{var Q,G;const{action:U,payload:X}=F.data;U==="queryError"?(clearTimeout(A),(Q=r.current)==null||Q.removeEventListener("message",M),O(new Error(X.error.message))):(U==="customQueryComplete"||U==="queryComplete")&&(clearTimeout(A),(G=r.current)==null||G.removeEventListener("message",M),k())};r.current.addEventListener("message",M),r.current.postMessage({action:"exec",payload:{query:D,currentTable:p,filters:null,sorters:null,limit:50,offset:0}})}),setTimeout(()=>{l(),u(!1),s()},100)}catch(C){console.error("保存失败:",C),g(C instanceof Error?C.message:"保存失败")}finally{x(!1)}},[d,e,h,p,j,o,l,s,r]),N=T.useMemo(()=>!e||!h?null:h.map((C,I)=>{const y=e.data[I],$=d[I]||"";return a.jsxs("div",{className:"border-primary/10 border shadow-sm",children:[a.jsx("label",{className:"bg-primary/5 border-primary/10 flex items-center gap-1 border-b p-1.5",children:a.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[a.jsx(Y,{className:"text-xs font-medium capitalize",children:C}),a.jsx(Y,{className:"text-primary/50 text-xs",children:typeof y=="string"?"TEXT":typeof y=="number"?"NUMBER":y===null?"NULL":"OTHER"})]})}),a.jsx("div",{className:"p-2",children:c?typeof y=="string"&&String(y).length>50?a.jsx(Kt,{className:"border-primary/20 focus:ring-primary/30 focus:border-primary/40 rounded border text-sm focus:ring-1",value:$,onChange:L=>v(I,L.target.value),placeholder:y===null?"NULL":""}):a.jsx(ze,{className:"border-primary/20 focus:ring-primary/30 focus:border-primary/40 h-9 rounded border text-sm focus:ring-1",value:$,onChange:L=>v(I,L.target.value),placeholder:y===null?"NULL":""}):y===null?a.jsx(dt,{children:"NULL"}):a.jsx("div",{className:"bg-primary/5 border-primary/10 rounded border p-2 text-sm max-h-32 overflow-y-auto",children:a.jsx(Y,{className:"text-xs break-all whitespace-pre-wrap",children:String(y)})})})]},C)}),[e,h,d,c,v]),E=T.useMemo(()=>a.jsxs("div",{className:"bg-primary/5 sticky top-0 z-10 flex w-full items-center justify-between gap-1 border-b p-2 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"bg-primary/10 rounded p-1.5",children:c?a.jsx(Xe,{className:"h-4 w-4"}):a.jsx(_s,{className:"h-4 w-4"})}),a.jsx(Y,{className:"text-sm font-medium whitespace-nowrap",children:c?"编辑查询结果":t}),e&&a.jsxs(Y,{className:"bg-primary/10 rounded-full px-2 py-0.5 text-xs",children:["行 ",e.index+1]}),p&&a.jsxs(Y,{className:"bg-blue-100 text-blue-800 rounded-full px-2 py-0.5 text-xs",children:["表: ",p]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[!c&&a.jsxs(a.Fragment,{children:[!j&&a.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[a.jsx(at,{className:"h-3 w-3"}),a.jsx(Y,{className:"text-xs",children:p?!o||!(p in o)?"表不存在":"复杂查询不可编辑":"无法识别表名"})]}),a.jsxs(P,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>u(!0),title:j?"编辑此行数据":"此查询结果不支持编辑",disabled:!j,children:[a.jsx(Xe,{className:"mr-1 h-3 w-3"}),"编辑"]})]}),a.jsxs(P,{size:"sm",variant:"outline",className:"text-xs",onClick:s,title:"返回数据表格","aria-label":"返回数据表格",children:[a.jsx(ut,{className:"mr-1 h-3 w-3"}),"返回"]})]})]}),[e,s,t,c,j,p,o]),z=T.useMemo(()=>c?a.jsxs("div",{className:"bg-primary/5 border-primary/10 flex w-full gap-2 border-t p-2 shadow-inner",children:[a.jsxs(P,{size:"sm",variant:"outline",className:"flex-1 py-2 text-xs font-medium",onClick:w,disabled:f||!j,"aria-label":"保存更改",children:[a.jsx(It,{className:"mr-2 h-3.5 w-3.5"}),f?"保存中...":"保存更改"]}),a.jsx(P,{size:"sm",variant:"ghost",className:"py-2 text-xs",onClick:()=>{u(!1),e&&h&&m(e.data.map(C=>(C==null?void 0:C.toString())??""))},disabled:f,"aria-label":"取消编辑",children:"取消"})]}):null,[c,w,e,h,f,j]);return a.jsxs("section",{className:"flex h-full flex-col",children:[E,a.jsxs("div",{className:"flex-1 overflow-auto p-2 space-y-2",children:[b&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[a.jsx(at,{className:"h-4 w-4"}),a.jsx(Y,{className:"text-sm font-medium",children:"保存错误"})]}),a.jsx("p",{className:"text-red-700 text-xs mt-1",children:b})]}),!j&&a.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded p-3 mb-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-amber-800",children:[a.jsx(at,{className:"h-4 w-4"}),a.jsx(Y,{className:"text-sm font-medium",children:"编辑限制"})]}),a.jsxs("p",{className:"text-amber-700 text-xs mt-1",children:[p?!o||!(p in o)?`表 "${p}" 不存在于数据库架构中。`:"当前查询包含复杂特征（如 JOIN、GROUP BY 等），无法直接编辑。":"无法从查询中识别表名。",a.jsx("br",{}),"只有简单的单表 SELECT 查询支持编辑功能。"]})]}),N]}),z]})}function qr(){const t=_.c(66),e=S(Yr),s=S(Xr),l=S(Kr),r=S(Gr),n=fe(Wr),i=fe(Vr),o=fe(Qr),d=fe(Br),m=S(Hr),{handleQueryExecute:c,handleExport:u}=xe(),{isEditing:f}=ve();let x;t[0]!==s?(x=()=>{s(null)},t[0]=s,t[1]=x):x=t[1];const b=x,g=r||l;let h;t[2]===Symbol.for("react.memo_cache_sentinel")?(h=a.jsx(Dt,{className:"mr-1 h-3 w-3"}),t[2]=h):h=t[2];let p;t[3]!==c||t[4]!==g?(p=a.jsxs(P,{size:"sm",variant:"outline",className:"w-[150px] text-xs",onClick:c,disabled:g,title:"Execute SQL",children:[h,"Execute SQL"]}),t[3]=c,t[4]=g,t[5]=p):p=t[5];const j=!(m!=null&&m.data);let v;t[6]!==u?(v=()=>u("custom","csv"),t[6]=u,t[7]=v):v=t[7];let w;t[8]===Symbol.for("react.memo_cache_sentinel")?(w=a.jsx($e,{className:"mr-1 h-3 w-3"}),t[8]=w):w=t[8];let N;t[9]===Symbol.for("react.memo_cache_sentinel")?(N=a.jsx(Ne,{className:"ml-1 h-3 w-3 opacity-50"}),t[9]=N):N=t[9];let E;t[10]!==j||t[11]!==v?(E=a.jsx(Je,{asChild:!0,children:a.jsxs(P,{size:"sm",variant:"outline",className:"text-xs",disabled:j,onClick:v,title:"Export data as CSV (click) or hover for more options",children:[w,"Export data",N]})}),t[10]=j,t[11]=v,t[12]=E):E=t[12];let z;t[13]!==u?(z=()=>u("custom","csv"),t[13]=u,t[14]=z):z=t[14];const C=!(m!=null&&m.data);let I;t[15]!==C||t[16]!==z?(I=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:z,disabled:C,children:"Export as CSV"})}),t[15]=C,t[16]=z,t[17]=I):I=t[17];let y;t[18]!==u?(y=()=>u("custom","txt"),t[18]=u,t[19]=y):y=t[19];const $=!(m!=null&&m.data);let L;t[20]!==y||t[21]!==$?(L=a.jsx(me,{asChild:!0,children:a.jsx(P,{variant:"ghost",size:"sm",className:"h-8 w-full justify-start text-xs",onClick:y,disabled:$,children:"Export as TXT"})}),t[20]=y,t[21]=$,t[22]=L):L=t[22];let D;t[23]!==I||t[24]!==L?(D=a.jsxs(Ze,{className:"w-32",children:[I,L]}),t[23]=I,t[24]=L,t[25]=D):D=t[25];let R;t[26]!==D||t[27]!==E?(R=a.jsxs(Ye,{children:[E,D]}),t[26]=D,t[27]=E,t[28]=R):R=t[28];let k;t[29]!==l||t[30]!==r?(k=(l||r)&&a.jsxs("span",{className:"ml-2 flex items-center text-xs text-gray-500",children:[a.jsx(xt,{className:"mr-1 h-3 w-3 animate-spin"}),"Loading data"]}),t[29]=l,t[30]=r,t[31]=k):k=t[31];let O;t[32]!==R||t[33]!==k||t[34]!==p?(O=a.jsxs("div",{className:"flex items-center gap-1 border-b px-1 py-2",children:[p,R,k]}),t[32]=R,t[33]=k,t[34]=p,t[35]=O):O=t[35];let A;t[36]!==e||t[37]!==b?(A=e&&a.jsxs("div",{className:"flex items-center justify-between p-2",children:[a.jsx("div",{className:"text-sm text-red-400",children:e}),a.jsx(P,{size:"sm",variant:"outline",className:"text-xs",onClick:b,children:a.jsx(kt,{className:"h-3 w-3"})})]}),t[36]=e,t[37]=b,t[38]=A):A=t[38];let M;t[39]===Symbol.for("react.memo_cache_sentinel")?(M=a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsx("div",{className:"flex-1",children:a.jsx(Er,{})}),a.jsx(kr,{})]}),t[39]=M):M=t[39];let F;t[40]!==A?(F=a.jsxs(Ee,{defaultSize:25,children:[A,M]}),t[40]=A,t[41]=F):F=t[41];let U;t[42]===Symbol.for("react.memo_cache_sentinel")?(U=a.jsx(ct,{withHandle:!0}),t[42]=U):U=t[42];let X;t[43]===Symbol.for("react.memo_cache_sentinel")?(X=a.jsx(Ee,{defaultSize:75,children:a.jsx("div",{className:"flex h-full flex-col justify-between border",children:a.jsx(zr,{})})}),t[43]=X):X=t[43];let Q;t[44]!==F?(Q=a.jsxs(ot,{direction:"vertical",children:[F,U,X]}),t[44]=F,t[45]=Q):Q=t[45];let G;t[46]!==n||t[47]!==o||t[48]!==Q?(G=a.jsx(Ee,{defaultSize:n,onResize:o,children:Q}),t[46]=n,t[47]=o,t[48]=Q,t[49]=G):G=t[49];let J;t[50]===Symbol.for("react.memo_cache_sentinel")?(J=a.jsx(ct,{className:"hidden md:flex",withHandle:!0}),t[50]=J):J=t[50];const Z=`static md:relative md:block ${f?"block":"hidden"}`;let ne;t[51]===Symbol.for("react.memo_cache_sentinel")?(ne=a.jsx("div",{className:"h-full overflow-hidden",children:a.jsx("div",{className:"h-full overflow-y-auto",children:a.jsx(ht,{})})}),t[51]=ne):ne=t[51];const de=`bg-background absolute top-0 right-0 z-40 h-full w-full ${f?"block":"hidden"}`;let ae;t[52]===Symbol.for("react.memo_cache_sentinel")?(ae=a.jsx("section",{className:"bg-primary/5 h-full",children:a.jsx(Ur,{title:"查看查询结果"})}),t[52]=ae):ae=t[52];let te;t[53]!==de?(te=a.jsx("div",{className:de,children:ae}),t[53]=de,t[54]=te):te=t[54];let ee;t[55]!==i||t[56]!==d||t[57]!==Z||t[58]!==te?(ee=a.jsxs(Ee,{defaultSize:i,onResize:d,className:Z,children:[ne,te]}),t[55]=i,t[56]=d,t[57]=Z,t[58]=te,t[59]=ee):ee=t[59];let se;t[60]!==G||t[61]!==ee?(se=a.jsx("div",{className:"h-full overflow-hidden",children:a.jsxs(ot,{direction:"horizontal",className:"h-full",children:[G,J,ee]})}),t[60]=G,t[61]=ee,t[62]=se):se=t[62];let ie;return t[63]!==O||t[64]!==se?(ie=a.jsxs("div",{className:"flex h-full flex-col",children:[O,se]}),t[63]=O,t[64]=se,t[65]=ie):ie=t[65],ie}function Hr(t){return t.customQueryObject}function Br(t){return t.setSchemaPanelSize}function Qr(t){return t.setDataPanelSize}function Vr(t){return t.schemaPanelSize}function Wr(t){return t.dataPanelSize}function Gr(t){return t.isDatabaseLoading}function Kr(t){return t.isDataLoading}function Xr(t){return t.setErrorMessage}function Yr(t){return t.errorMessage}const Jr=()=>{const{handleFileUpload:t}=xe(),[e,s]=T.useState(!1),l=T.useCallback(i=>{var o;i.preventDefault(),i.stopPropagation(),(o=i.dataTransfer)!=null&&o.types&&(i.dataTransfer.types.includes("Files")||i.dataTransfer.types.includes("application/x-moz-file"))&&s(!0)},[]),r=T.useCallback(i=>{i.preventDefault(),i.stopPropagation(),i.target===document.documentElement&&s(!1)},[]),n=T.useCallback(i=>{var o,d,m,c,u;i.preventDefault(),i.stopPropagation(),s(!1);try{if(!((d=(o=i.dataTransfer)==null?void 0:o.types)!=null&&d.includes("Files"))&&!((c=(m=i.dataTransfer)==null?void 0:m.types)!=null&&c.includes("application/x-moz-file")))return;const f=(u=i.dataTransfer)==null?void 0:u.files;if(!f||f.length===0){K("No file detected","error");return}const x=f[0];t(x)}catch(f){const x=f instanceof Error?f.message:"Failed to process file";K(`Failed to process file: ${x}`,"error")}},[t]);return T.useEffect(()=>(window.addEventListener("dragover",l),window.addEventListener("dragleave",r),window.addEventListener("drop",n),()=>{window.removeEventListener("dragover",l),window.removeEventListener("dragleave",r),window.removeEventListener("drop",n)}),[l,r,n]),{isDragging:e}};function Zr(t){const e=_.c(5),{children:s}=t,{isDragging:l}=Jr();let r;e[0]!==l?(r=l&&a.jsx("section",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm transition-all",children:a.jsxs("div",{className:"border-primary/60 bg-background/95 animate-in fade-in zoom-in-95 flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 shadow-lg transition-transform duration-200",children:[a.jsx("div",{className:"bg-primary/10 mb-6 flex items-center justify-center rounded-full p-5",children:a.jsx(Te,{className:"text-primary h-12 w-12"})}),a.jsx("h3",{className:"mb-2 text-xl font-medium",children:"Drop SQLite Database"}),a.jsx("p",{className:"text-muted-foreground mb-4 text-center text-sm",children:"Release to load your database file"})]})}),e[0]=l,e[1]=r):r=e[1];let n;return e[2]!==s||e[3]!==r?(n=a.jsxs(a.Fragment,{children:[s,r]}),e[2]=s,e[3]=r,e[4]=n):n=e[4],n}function en(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(aa,{"data-slot":"dialog",...s}),e[2]=s,e[3]=l):l=e[3],l}function tn(t){const e=_.c(4);let s;e[0]!==t?({...s}=t,e[0]=t,e[1]=s):s=e[1];let l;return e[2]!==s?(l=a.jsx(ia,{"data-slot":"dialog-portal",...s}),e[2]=s,e[3]=l):l=e[3],l}function sn(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx(ca,{"data-slot":"dialog-overlay",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function an(t){const e=_.c(12);let s,l,r;e[0]!==t?({className:l,children:s,...r}=t,e[0]=t,e[1]=s,e[2]=l,e[3]=r):(s=e[1],l=e[2],r=e[3]);let n;e[4]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(sn,{}),e[4]=n):n=e[4];let i;e[5]!==l?(i=B("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",l),e[5]=l,e[6]=i):i=e[6];let o;e[7]===Symbol.for("react.memo_cache_sentinel")?(o=a.jsxs(oa,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[a.jsx(kt,{}),a.jsx("span",{className:"sr-only",children:"Close"})]}),e[7]=o):o=e[7];let d;return e[8]!==s||e[9]!==r||e[10]!==i?(d=a.jsxs(tn,{"data-slot":"dialog-portal",children:[n,a.jsxs(la,{"data-slot":"dialog-content",className:i,...r,children:[s,o]})]}),e[8]=s,e[9]=r,e[10]=i,e[11]=d):d=e[11],d}function ln(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("flex flex-col gap-2 text-center sm:text-left",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx("div",{"data-slot":"dialog-header",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function rn(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx("div",{"data-slot":"dialog-footer",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function nn(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("text-lg leading-none font-semibold",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx(ra,{"data-slot":"dialog-title",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function on(t){const e=_.c(8);let s,l;e[0]!==t?({className:s,...l}=t,e[0]=t,e[1]=s,e[2]=l):(s=e[1],l=e[2]);let r;e[3]!==s?(r=B("text-muted-foreground text-sm",s),e[3]=s,e[4]=r):r=e[4];let n;return e[5]!==l||e[6]!==r?(n=a.jsx(na,{"data-slot":"dialog-description",className:r,...l}),e[5]=l,e[6]=r,e[7]=n):n=e[7],n}function cn(){const{handleFileUpload:t}=xe(),e=S(x=>x.setIsDatabaseLoading),[s,l]=T.useState(null),[r,n]=T.useState(null),[i,o]=T.useState(!1),d=T.useRef(!1),m=T.useRef(!1),c=T.useCallback(x=>{try{return new URL(x),!0}catch{return!1}},[]),u=T.useCallback(async(x,b=!1)=>{if(m.current)return console.log("Fetch already in progress, ignoring duplicate call"),!1;if(m.current=!0,!c(x)){const g="Invalid URL format";return l(g),K(g,"error"),m.current=!1,!1}try{e(!0);const g=b?`https://corsproxy.io/?url=${encodeURIComponent(x)}`:x,h=await fetch(g,{method:"GET"});if(!h.ok)throw new Error(`HTTP error! status: ${h.status}`);K(b?"Retrieving database with CORS proxy, please wait":"Retrieving database, please wait","info");const p=await h.blob();if(p.size<100)throw new Error("The downloaded file seems too small to be a valid SQLite database");const j=new File([p],"database.sqlite");return t(j),K("Database loaded successfully","success"),l(null),!0}catch(g){const h=g instanceof Error?g.message:String(g);return l(h),b?K(`Failed to load with CORS proxy: ${h}`,"error"):(n(x),o(!0)),!1}finally{e(!1),m.current=!1}},[t,c,e]);T.useEffect(()=>{if(d.current)return;d.current=!0;const x=new AbortController;return(async()=>{const h=new URLSearchParams(window.location.search).get("url");if(h){const p=decodeURIComponent(h);try{await u(p)}catch(j){console.error("Initial fetch error:",j)}}})(),()=>{x.abort()}},[u]);const f=T.useCallback(()=>{r&&(u(r,!0),o(!1))},[r,u]);return a.jsx(en,{open:i,onOpenChange:o,children:a.jsxs(an,{className:"sm:max-w-md",children:[a.jsxs(ln,{children:[a.jsx(nn,{className:"text-xl font-semibold",children:"CORS Error Detected"}),a.jsx(on,{className:"text-muted-foreground pt-2 text-sm",children:"Something went wrong while loading the database. This might be due to Cross-Origin Resource Sharing (CORS) restrictions."})]}),a.jsxs("div",{className:"mt-4 space-y-4",children:[a.jsxs("p",{className:"text-sm",children:["Would you like to try using a CORS proxy?"," ",a.jsx("span",{className:"font-medium text-yellow-500 dark:text-yellow-400",children:"Note that this will send your database request through a third-party service."})]}),s&&a.jsx("div",{className:"bg-destructive/10 dark:bg-destructive/20 rounded-md p-3 text-red-400",children:a.jsxs("p",{className:"text-xs",children:["Error details: ",s]})})]}),a.jsxs(rn,{className:"mt-6 flex justify-end gap-3",children:[a.jsx(P,{variant:"outline",onClick:()=>{o(!1),l(null)},children:"Cancel"}),a.jsx(P,{variant:"default",onClick:f,children:"Use CORS Proxy"})]})]})})}function dn(){const t=_.c(28),e=S(un),s=S(mn);let l;t[0]!==s?(l=w=>{w==="execute"&&s(null)},t[0]=s,t[1]=l):l=t[1];const r=l;let n;t[2]===Symbol.for("react.memo_cache_sentinel")?(n=a.jsx(cn,{}),t[2]=n):n=t[2];let i;t[3]===Symbol.for("react.memo_cache_sentinel")?(i=a.jsx(nl,{}),t[3]=i):i=t[3];let o,d;t[4]===Symbol.for("react.memo_cache_sentinel")?(o=a.jsx(Ge,{className:"hidden h-4 w-4 md:block"}),d=a.jsx("span",{children:"Browse Data"}),t[4]=o,t[5]=d):(o=t[4],d=t[5]);let m;t[6]!==e?(m=a.jsxs(lt,{id:"data",disabled:e,value:"data",className:"data-[state=active]: data-[state=active]:border-primary h-8 rounded-none text-xs",children:[o,d]},"data"),t[6]=e,t[7]=m):m=t[7];let c;t[8]===Symbol.for("react.memo_cache_sentinel")?(c=a.jsx(Ls,{className:"hidden h-4 w-4 md:block"}),t[8]=c):c=t[8];let u;t[9]!==e?(u=a.jsxs(lt,{disabled:e,id:"execute",value:"execute",className:"data-[state=active]: data-[state=active]:border-primary h-8 rounded-none text-xs",children:[c,"Execute SQL"]},"execute"),t[9]=e,t[10]=u):u=t[10];let f;t[11]===Symbol.for("react.memo_cache_sentinel")?(f=a.jsx(Te,{className:"hidden h-4 w-4 md:block"}),t[11]=f):f=t[11];let x;t[12]!==e?(x=a.jsxs(lt,{id:"structure",disabled:e,value:"structure",className:"data-[state=active]: data-[state=active]:border-primary h-8 rounded-none text-xs",children:[f,"Database Structure"]},"structure"),t[12]=e,t[13]=x):x=t[13];let b;t[14]!==m||t[15]!==u||t[16]!==x?(b=a.jsxs(Za,{className:"bg-primary/5 h-9 w-full justify-start rounded-none border-b",children:[m,u,x]}),t[14]=m,t[15]=u,t[16]=x,t[17]=b):b=t[17];let g;t[18]!==e?(g=a.jsx(rt,{value:"data",className:"m-0 h-full border-none p-0",children:e?a.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-4",children:[a.jsx("div",{className:"bg-primary/10 rounded-full p-4",children:a.jsx(xt,{className:"text-primary h-8 w-8 animate-spin"})}),a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("span",{className:"text-xl font-medium",children:"Loading Database"}),a.jsx("span",{className:"text-muted-foreground text-sm",children:"Please wait while the database is initializing"})]})]}):a.jsx(mr,{})}),t[18]=e,t[19]=g):g=t[19];let h;t[20]===Symbol.for("react.memo_cache_sentinel")?(h=a.jsx(rt,{value:"structure",className:"m-0 h-full border-none p-0",children:a.jsx($l,{})}),t[20]=h):h=t[20];let p;t[21]===Symbol.for("react.memo_cache_sentinel")?(p=a.jsx(rt,{value:"execute",className:"m-0 h-full border border-none p-0",children:a.jsx(qr,{})}),t[21]=p):p=t[21];let j;t[22]!==g?(j=a.jsxs("section",{className:"max-h-custom-dvh flex-1 overflow-hidden",children:[g,h,p]}),t[22]=g,t[23]=j):j=t[23];let v;return t[24]!==r||t[25]!==b||t[26]!==j?(v=a.jsxs(a.Fragment,{children:[n,a.jsx(Zr,{children:a.jsxs("main",{className:"bg-primary/5 flex h-screen flex-col overflow-hidden",children:[i,a.jsxs(Ja,{defaultValue:"data",className:"flex flex-1 flex-col",onValueChange:r,children:[b,j]})]})})]}),t[24]=r,t[25]=b,t[26]=j,t[27]=v):v=t[27],v}function mn(t){return t.setFilters}function un(t){return t.isDatabaseLoading}Jt.createRoot(document.getElementById("root")).render(a.jsx(T.StrictMode,{children:a.jsxs(Na,{defaultTheme:"light",storageKey:"ui-theme",children:[a.jsx(Ya,{children:a.jsx(va,{children:a.jsx(dn,{})})}),a.jsx(ya,{})]})}));
